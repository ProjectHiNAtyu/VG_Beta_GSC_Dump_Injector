// S4 GSC SOURCE
// Generated by https://github.com/xensik/gsc-tool

main()
{
    if ( isdefined( level._id_03E1 ) )
        return;

    init();

    if ( scripts\common\utility::_id_8A2C() )
    {
        level.player thread _id_FBCC();
        level thread _id_9A15();
        level thread _id_EFA0();
        level thread _id_7BAC();

        if ( getdvarint( "scr_suspicious_stealth_doors" ) )
            _id_E7E6();
    }
    else
        level thread _id_EFA0();
}

init()
{
    scripts\engine\utility::_id_5BFB( "stealth_enabled" );
    level._id_03E1 = spawnstruct();
    level._id_03E1._id_4871 = spawnstruct();
    level._id_03E1._id_CB24 = spawnstruct();
    level._id_03E1._id_0031 = [];
    level._id_03E1._id_6016 = [];
    level._id_03E1._id_4871._id_E744 = "hidden";
    level._id_03E1._id_4871._id_C00D = [];
    level._id_03E1._id_4871._id_C00D["hidden"] = [];
    level._id_03E1._id_4871._id_C00D["spotted"] = [];
    level._id_03E1._id_4871._id_9F20["hidden"] = [];
    level._id_03E1._id_4871._id_9F20["spotted"] = [];
    level._id_03E1._id_4871._id_F221 = 5;
    _id_0881::_id_3D5A();
    _id_0884::_id_5683();
    level._id_03E1._id_A46F = 3000;
    level._id_03E1._id_75CA = 8;
    level._id_03E1._id_71D7 = spawnstruct();
    level._id_03E1._id_71D7._id_01AF = [];
    level._id_03E1._id_71D7._id_7212 = [];
    level._id_03E1._id_71D7._id_15E4 = [];
    level._id_03E1._id_71D7._id_4389 = [];
    level._id_03E1._id_7BC1 = [];
    _id_D1AD();
    _id_80AC();
    _id_0880::_id_7FA1();
    _id_8081();
    _id_088C::_id_140A();
    level._id_03E1._id_9E80 = 1;
    _id_D81D();
}

_id_D81D()
{
    level _id_088C::_id_D3B7( "do_stealth", _id_088C::_id_4C07 );
    _id_0883::_id_D1B3();
    level._id_03E1._id_5D73 = _id_088C::_id_71FF;
    level._id_03E1._id_5D76 = undefined;
    level._id_03E1._id_5D9C = _id_088C::_id_D1D0;
}

_id_D1AD()
{
    var_0 = [];
    var_0["prone"] = 400;
    var_0["crouch"] = 800;
    var_0["stand"] = 1500;
    var_1 = [];
    var_1["prone"] = 800;
    var_1["crouch"] = 1500;
    var_1["stand"] = 3000;
    _id_088C::_id_D1C0( var_0, var_1 );
    var_2 = [];
    var_2["prone"] = 130;
    var_2["crouch"] = 215;
    var_2["stand"] = 300;
    var_3 = [];
    var_3["prone"] = 300;
    var_3["crouch"] = 375;
    var_3["stand"] = 450;
    _id_088C::_id_D283( var_2, var_3 );
    _id_0881::_id_D18E();
    _id_7F5D();
    _id_088C::_id_D1CF( 0 );
    _id_5672( "hidden" );
}

_id_7F5D()
{
    var_0["ai_eventDistDeath"]["spotted"] = getdvarint( "#x369837a382edc09e9" );
    var_0["ai_eventDistDeath"]["hidden"] = 512;
    var_0["ai_eventDistPain"]["spotted"] = getdvarint( "#x32df4987ccda0bbf9" );
    var_0["ai_eventDistPain"]["hidden"] = 256;
    var_0["ai_eventDistExplosion"]["spotted"] = getdvarint( "#x3d3df7b3e81cee60c" );
    var_0["ai_eventDistExplosion"]["hidden"] = 2048;
    var_0["ai_eventDistBullet"]["spotted"] = getdvarint( "#x3f89ebd5d081d68d5" );
    var_0["ai_eventDistBullet"]["hidden"] = 64;
    var_0["ai_eventDistFootstepWalk"]["spotted"] = getdvarint( "#x3ffd7701a5091414a" );
    var_0["ai_eventDistFootstepWalk"]["hidden"] = 50;
    var_0["ai_eventDistFootstep"]["spotted"] = getdvarint( "#x3810dc6d5fdd9c917" );
    var_0["ai_eventDistFootstep"]["hidden"] = 100;
    var_0["ai_eventDistFootstepSprint"]["spotted"] = getdvarint( "#x3eae191c711149ed3" );
    var_0["ai_eventDistFootstepSprint"]["hidden"] = 400;
    var_0["ai_eventDistGunShot"]["spotted"] = getdvarint( "#x3c3b5d6d02b304c91" );
    var_0["ai_eventDistGunShot"]["hidden"] = 1500;
    var_0["ai_eventDistSilencedShot"]["spotted"] = getdvarint( "#x3384542aeef7ca94c" );
    var_0["ai_eventDistSilencedShot"]["hidden"] = 180;
    var_0["ai_eventDistGlassDestroyed"]["spotted"] = getdvarint( "#x3941d3a49ba681266" );
    var_0["ai_eventDistGlassDestroyed"]["hidden"] = 384;

    if ( getdvarint( "#x38c94261fb42b5341", 0 ) )
    {
        var_0["ai_eventDistGunShotTeam"]["spotted"] = 256;
        var_0["ai_eventDistGunShotTeam"]["hidden"] = 256;
    }
    else
    {
        var_0["ai_eventDistGunShotTeam"]["spotted"] = getdvarint( "#x3a1eff3aa41a12ca8" );
        var_0["ai_eventDistGunShotTeam"]["hidden"] = 750;
    }

    var_0["ai_eventDistNewEnemy"]["spotted"] = 128;
    var_0["ai_eventDistNewEnemy"]["hidden"] = 128;
    _id_D1E5( var_0 );
}

_id_D1E5( var_0 )
{
    foreach ( var_6, var_2 in var_0 )
    {
        foreach ( var_5, var_4 in var_2 )
            level._id_03E1._id_0031[var_6][var_5] = var_4;
    }
}

_id_D19D( var_0 )
{
    foreach ( var_7, var_2 in var_0 )
    {
        foreach ( var_6, var_4 in var_2 )
        {
            level._id_03E1._id_0031[var_7][var_6] = var_4;

            if ( level._id_03E1._id_4871._id_E744 == var_6 )
            {
                setsaveddvar( var_7, var_4 );
                var_5 = "ai_busyEvent" + _func_00D6( var_7, 8 );
                setsaveddvar( var_5, var_4 );
            }
        }
    }
}

_id_D1C1( var_0, var_1 )
{
    var_2 = 0.25;

    if ( isdefined( var_0 ) )
    {
        level._id_03E1._id_4871._id_C00D["hidden"]["prone"] = var_0["prone"];
        level._id_03E1._id_4871._id_C00D["hidden"]["crouch"] = var_0["crouch"];
        level._id_03E1._id_4871._id_C00D["hidden"]["stand"] = var_0["stand"];

        if ( !isdefined( var_0["shadow"] ) )
            var_0["shadow"] = var_2;

        level._id_03E1._id_4871._id_C00D["hidden"]["shadow"] = var_0["shadow"];
    }

    if ( isdefined( var_1 ) )
    {
        level._id_03E1._id_4871._id_C00D["spotted"]["prone"] = var_1["prone"];
        level._id_03E1._id_4871._id_C00D["spotted"]["crouch"] = var_1["crouch"];
        level._id_03E1._id_4871._id_C00D["spotted"]["stand"] = var_1["stand"];

        if ( !isdefined( var_1["shadow"] ) )
            var_1["shadow"] = var_2;

        level._id_03E1._id_4871._id_C00D["spotted"]["shadow"] = var_1["shadow"];
    }
}

_id_9A15()
{
    for (;;)
    {
        scripts\engine\utility::_id_5C04( "stealth_enabled" );
        _id_088B::_id_F14C( 1 );

        if ( !_id_B6FF() )
            setsaveddvar( "#x3102271c5c0c0f040", 1 );

        scripts\engine\utility::_id_5C04( "stealth_spotted" );

        if ( !_id_B6FF() )
            setsaveddvar( "#x3102271c5c0c0f040", 0 );

        if ( !scripts\engine\utility::_id_5BE0( "stealth_enabled" ) )
            continue;

        _id_5672( "spotted" );
        scripts\engine\utility::_id_5C10( "stealth_spotted" );

        if ( !scripts\engine\utility::_id_5BE0( "stealth_enabled" ) )
            continue;

        _id_5672( "hidden" );
        waittillframeend;
    }
}

_id_18ED()
{
    if ( isdefined( level._id_03E1._id_7208 ) )
    {
        foreach ( var_1 in level._id_03E1._id_7208._id_7212 )
        {
            if ( _id_0886::_id_71DB( var_1.name ) )
                return 1;
        }
    }

    var_3 = _func_0074( "bad_guys", "all" );

    foreach ( var_5 in var_3 )
    {
        if ( !isdefined( var_5._id_03E1 ) && isdefined( var_5._id_017D ) && var_5._id_017D == self )
            return 1;
    }

    return 0;
}

_id_FBCC()
{
    waitframe();
    var_0 = 0;

    for (;;)
    {
        var_1 = _id_18ED();

        if ( var_1 )
        {
            if ( !var_0 && isdefined( level._id_03E1._id_E7E4 ) )
            {
                wait( level._id_03E1._id_E7E4 );

                if ( !_id_18ED() )
                {
                    waitframe();
                    continue;
                }
            }

            if ( !scripts\engine\utility::_id_5BE0( "stealth_spotted" ) )
            {
                scripts\engine\utility::_id_5BFB( "stealth_spotted" );

                if ( isdefined( self._id_03E1 ) )
                {
                    var_2 = _id_088C::_id_64B3( "stealth_spotted" );
                    scripts\engine\utility::_id_5BFB( var_2 );
                }
            }
        }
        else if ( scripts\engine\utility::_id_5BE0( "stealth_spotted" ) )
        {
            scripts\engine\utility::_id_5BE4( "stealth_spotted" );

            if ( isdefined( self._id_03E1 ) )
            {
                var_2 = _id_088C::_id_64B3( "stealth_spotted" );
                scripts\engine\utility::_id_5BE4( var_2 );
            }
        }

        var_0 = var_1;
        waitframe();
    }
}

_id_EFA0()
{
    level._id_03E1._id_533F["axis"] = [];
    level._id_03E1._id_533F["allies"] = [];

    for (;;)
    {
        scripts\engine\utility::_id_5C04( "stealth_enabled" );
        level._id_03E1._id_533F["axis"] = level.players;
        level._id_03E1._id_533F["allies"] = _func_0070( "axis" );
        wait 0.05;
    }
}

_id_7BAC()
{
    for (;;)
    {
        scripts\engine\utility::_id_5C04( "stealth_enabled" );

        if ( isdefined( level._id_03E1._id_7BAA ) && level._id_03E1._id_7BAA.size != 0 )
        {
            foreach ( var_2, var_1 in level._id_03E1._id_7BAA )
            {
                _id_0880::_id_7BB2( var_2, var_1 );
                wait 0.2;
            }

            continue;
        }

        wait 0.5;
    }
}

_id_5672( var_0 )
{
    level._id_03E1._id_4871._id_E744 = var_0;

    foreach ( var_4, var_2 in level._id_03E1._id_0031 )
    {
        setsaveddvar( var_4, var_2[var_0] );
        var_3 = "ai_busyEvent" + _func_00D6( var_4, 8 );
        setsaveddvar( var_3, var_2[var_0] );
    }
}

_id_8081()
{
    scripts\engine\utility::_id_5BF1( "stealth_player_nade" );
    level._id_03E1._id_CB24._id_B543 = 0;
    scripts\engine\utility::_id_1BBA( level.players, ::_id_B4AA );
}

_id_B4AA()
{
    for (;;)
    {
        self waittill( "grenade_pullback" );
        scripts\engine\utility::_id_5BFB( "stealth_player_nade" );
        self waittill( "grenade_fire", var_0 );
        thread _id_B4AB( var_0 );
    }
}

_id_B4AB( var_0 )
{
    level._id_03E1._id_CB24._id_B543++;
    var_0 scripts\engine\utility::_id_108F3( "death", 10 );
    level._id_03E1._id_CB24._id_B543--;
    waittillframeend;

    if ( !level._id_03E1._id_CB24._id_B543 )
        scripts\engine\utility::_id_5BE4( "stealth_player_nade" );
}

_id_E7E6()
{
    if ( istrue( level._id_D9D3 ) )
        return;

    if ( isdefined( level._id_03E1 ) )
    {
        if ( !isdefined( level._id_03E1._id_EBE7 ) )
        {
            level._id_03E1._id_EBE7 = spawnstruct();
            level._id_03E1._id_EBE7._id_4E2C = [];
            level._id_03E1._id_EBE7._id_C5E6 = 30;
            level._id_03E1._id_EBE7._id_DD2F = _func_0214( 600 );
            level._id_03E1._id_EBE7._id_4873 = _func_0214( 500 );
            level._id_03E1._id_EBE7._id_5EF1 = _func_0214( 300 );
        }

        level _id_088C::_id_D3B7( "suspicious_door", _id_0881::_id_EBE8 );
        level _id_0884::_id_568C( "investigate", "suspicious_door", 20 );
    }
}

_id_80AC()
{
    level._id_03E1._id_3A86 = [];
    level._id_03E1._id_7BAF = [];
    level._id_03E1._id_8504 = [];
    var_0 = getentarray( "info_volume_stealth_all", "classname" );
    var_1 = getentarray( "info_volume_stealth_combat", "classname" );
    var_1 = scripts\engine\utility::array_combine( var_1, var_0 );

    if ( isdefined( var_1 ) )
    {
        foreach ( var_3 in var_1 )
        {
            var_4 = strtok( var_3._id_CE61, " " );

            foreach ( var_6 in var_4 )
                level._id_03E1._id_3A86[var_6] = var_3;
        }
    }

    var_1 = getentarray( "info_volume_stealth_hunt", "classname" );
    var_1 = scripts\engine\utility::array_combine( var_1, var_0 );

    if ( isdefined( var_1 ) )
    {
        foreach ( var_3 in var_1 )
        {
            var_4 = strtok( var_3._id_CE61, " " );

            foreach ( var_6 in var_4 )
                level._id_03E1._id_7BAF[var_6] = var_3;
        }
    }

    var_1 = getentarray( "info_volume_stealth_investigate", "classname" );
    var_1 = scripts\engine\utility::array_combine( var_1, var_0 );

    if ( isdefined( var_1 ) )
    {
        foreach ( var_3 in var_1 )
        {
            var_4 = strtok( var_3._id_CE61, " " );

            foreach ( var_6 in var_4 )
                level._id_03E1._id_8504[var_6] = var_3;
        }
    }
}

_id_B6FF()
{
    if ( isdefined( level._id_03E1 ) && isdefined( level._id_03E1._id_5D91 ) )
        return [[ level._id_03E1._id_5D91 ]]();

    return 0;
}
