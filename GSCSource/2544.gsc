// S4 GSC SOURCE
// Generated by https://github.com/xensik/gsc-tool

_id_ECA9()
{
    if ( !isdefined( level._id_ECE3 ) )
    {
        var_0 = getentarray( "tactical_cover_col", "targetname" );

        if ( isdefined( var_0 ) )
            level._id_ECE3 = var_0[0];
    }

    level._id_ECE8 = getentarray( "dcover_blocker", "targetname" );
}

_id_ECAC( var_0, var_1 )
{
    self notify( "tac_cover_given" );
}

_id_ECAD( var_0, var_1, var_2 )
{
    self notify( "tac_cover_taken" );
    self._id_ECE6 = undefined;
}

_id_ECB6( var_0 )
{
    waitframe();

    if ( isdefined( var_0 ) )
        var_0 delete();
}

_id_ECAA( var_0, var_1, var_2, var_3 )
{
    self._id_ECE6 = 1;
    var_4 = physics_createcontents( [ "physicscontents_characterproxy", "physicscontents_playerclip", "physicscontents_water", "physicscontents_vehicle" ] );
    var_5 = _id_ECA8( self );
    var_6 = anglestoforward( self.angles );
    var_7 = self.origin + var_6 * 32;
    var_8 = _id_099E::_id_CEDA( var_7, 140, 20 );
    var_9 = undefined;
    var_10 = 0;

    foreach ( var_12 in var_8 )
    {
        var_13 = distancesquared( var_12.origin, var_7 );

        if ( isdefined( var_9 ) && var_10 <= var_13 )
            continue;

        var_9 = var_12;
        var_10 = var_13;
    }

    if ( isdefined( var_9 ) )
    {
        var_15 = self gettagorigin( "j_spinelower" );
        var_16 = var_9._id_39B3 + ( 0, 0, 24 );
        var_17 = _func_02BC( var_15, var_16, var_4, var_5, 0, "physicsquery_any", 1 );

        if ( isdefined( var_17 ) && var_17 > 0 )
        {
            _id_ECA0( 1 );
            return 0;
        }

        var_18 = var_9 _meth_872D();
        var_19 = abs( var_18 ) > 65;
        var_20 = undefined;

        foreach ( var_22 in var_8 )
        {
            if ( var_9 _id_099E::_id_CEDE( var_22 ) )
            {
                var_20 = var_22;
                break;
            }
        }

        var_24 = 1;

        if ( isdefined( var_20 ) )
        {
            var_25 = var_20 _meth_872D();
            var_24 = abs( var_25 ) > 65;
        }

        if ( var_10 < 1600 && var_19 && var_24 )
        {
            var_9._id_8768 = 1;
            self._id_ECE6 = undefined;
            thread _id_ECB4( var_9, var_20, var_3, var_4 );
            _id_0A7B::_id_7D93( "deployableCoverUsed", 1 );
            return 1;
        }
        else if ( var_10 < 6400 )
        {
            _id_ECA0( 1 );
            return 0;
        }
    }

    var_26 = self getplayerangles() * ( 0, 1, 0 );
    var_27 = self.origin + ( 0, 0, 24 );
    var_28 = anglestoforward( var_26 );
    var_29 = 29.5;
    var_30 = var_27 + var_28 * var_29;
    var_17 = _func_02BC( var_27, var_30, var_4, var_5, 0, "physicsquery_closest", 1 );

    if ( isdefined( var_17 ) && var_17.size > 0 )
    {
        _id_ECA0();
        return 0;
    }

    var_31 = undefined;
    var_32 = undefined;
    var_27 = var_30;
    var_28 = anglestoright( var_26 );
    var_29 = 55.5;
    var_33 = var_27 + var_28 * var_29;
    var_17 = _func_02BD( var_27, var_33, 2.5, var_4, var_5, "physicsquery_closest" );

    if ( isdefined( var_17 ) && var_17.size > 0 )
    {
        var_34 = var_17[0]["shape_position"];
        var_31 = var_17[0]["fraction"];
    }
    else
        var_31 = 1;

    var_27 = var_30;
    var_28 = -1 * anglestoright( var_26 );
    var_29 = 55.5;
    var_33 = var_27 + var_28 * var_29;
    var_17 = _func_02BD( var_27, var_33, 2.5, var_4, var_5, "physicsquery_closest" );

    if ( isdefined( var_17 ) && var_17.size > 0 )
    {
        var_34 = var_17[0]["shape_position"];
        var_32 = var_17[0]["fraction"];
    }
    else
        var_32 = 1;

    if ( var_32 + var_31 < 1 )
    {
        _id_ECA0();
        return 0;
    }
    else if ( var_31 < 0.5 )
        var_30 = var_30 + var_28 * var_29 * ( 0.5 - var_31 );
    else if ( var_32 < 0.5 )
        var_30 = var_30 + var_28 * var_29 * ( 0.5 - var_32 ) * -1;

    var_35 = var_26;
    var_27 = var_30;
    var_28 = ( 0, 0, -1 );
    var_29 = 60;
    var_33 = var_27 + var_28 * var_29;
    var_36 = _func_0047( var_35, ( 0, 0, 90 ) );
    var_17 = _func_02BE( var_27, var_33, 2.5, 16.8, var_36, var_4, var_5, "physicsquery_closest" );

    if ( !isdefined( var_17 ) || var_17.size <= 0 )
    {
        _id_ECA0();
        return 0;
    }

    var_37 = var_17[0]["entity"];

    if ( isdefined( var_37 ) && !_id_EC92( var_37 ) )
    {
        _id_ECA0();
        return 0;
    }

    var_38 = var_17[0]["shape_position"];
    var_34 = var_17[0]["position"];
    var_39 = var_38 - ( 0, 0, 2.5 );
    var_40 = 25.025;
    var_41 = playrumbleonposition( var_40 * 0.14, 2 );
    var_42 = var_38;
    var_43 = distance2dsquared( var_42, var_34 );
    var_44 = var_38 + anglestoright( var_26 ) * 14.3 * 1.75;
    var_45 = distance2dsquared( var_44, var_34 );
    var_46 = var_38 + anglestoright( var_26 ) * 14.3 * 1.75 * -1;
    var_47 = distance2dsquared( var_46, var_34 );
    var_48 = [];
    var_49 = 0;

    if ( var_45 <= var_41 && var_45 < var_43 && var_45 < var_47 )
    {
        var_49++;
        var_48 = [ var_42, var_46 ];
    }
    else if ( var_47 <= var_41 && var_47 < var_43 && var_47 < var_45 )
    {
        var_49++;
        var_48 = [ var_42, var_44 ];
    }
    else if ( var_43 <= var_41 )
    {
        var_49++;
        var_48 = [ var_46, var_44 ];
    }
    else
        var_48 = [ var_42, var_46, var_44 ];

    var_28 = ( 0, 0, -1 );
    var_29 = 8.5;

    foreach ( var_27 in var_48 )
    {
        var_33 = var_27 + var_28 * var_29;
        var_17 = _func_02BC( var_27, var_33, var_4, var_5, 0, "physicsquery_closest", 1 );

        if ( !isdefined( var_17 ) || var_17.size <= 0 )
            continue;

        var_37 = var_17[0]["entity"];

        if ( isdefined( var_37 ) && !_id_EC92( var_37 ) )
        {
            _id_ECA0();
            return 0;
        }

        var_49++;

        if ( var_49 >= 2 )
            break;
    }

    if ( var_49 < 2 )
    {
        _id_ECA0();
        return 0;
    }

    self._id_ECE6 = undefined;
    thread _id_ECB1( var_39, var_35, undefined, var_3, var_4 );
    _id_0A7B::_id_7D93( "deployableCoverUsed", 1 );
    return 1;
}

_id_EC90( var_0, var_1, var_2 )
{
    var_3 = _id_ECA3( 1, var_0, var_1, var_2, 32 );

    if ( !isdefined( var_3 ) )
        return var_0;

    var_4 = _id_ECA3( 0, var_0, var_1, var_2, 32 );

    if ( !isdefined( var_4 ) )
        return var_0;

    var_5 = min( var_3, 15 );
    var_6 = anglestoforward( var_1 );
    var_7 = var_0 + var_6 * var_5;

    foreach ( var_9 in level._id_ECE8 )
    {
        if ( _func_0119( var_7 + ( 0, 0, 20 ), var_9 ) )
        {
            var_7 = var_7 + ( 0, 0, -6 );
            break;
        }
    }

    return var_7;
}

_id_ECA3( var_0, var_1, var_2, var_3, var_4 )
{
    var_5 = anglestoleft( var_2 );
    var_6 = anglestoforward( var_2 );
    var_7 = -1 * var_6;
    var_8 = undefined;

    if ( var_0 )
        var_8 = var_6 * var_4;
    else
        var_8 = var_7 * var_4;

    var_9 = var_1 + ( 0, 0, 48 );
    var_10 = var_9;
    var_11 = var_9 + var_8;
    var_12 = 2.5;
    var_13 = 29.0 + var_4;
    var_14 = _func_0047( var_2, ( 0, 0, 90 ) );
    var_3 = var_3;
    var_15 = [ self ];
    var_16 = "physicsquery_closest";
    var_17 = _func_02BE( var_10, var_11, var_12, var_13, var_14, var_3, var_15, var_16 );
    var_18 = var_17.size == 0;

    if ( var_18 )
        return undefined;

    var_25 = var_17[0]["shape_position"];
    var_26 = distance( var_25, var_9 );
    return var_26;
}

_id_ECA0( var_0 )
{
    var_1 = scripts\engine\utility::ter_op( istrue( var_0 ), "MP/TAC_COVER_PLACE_IN_DOORWAY", "MP/TAC_COVER_CANNOT_PLACE" );

    if ( scripts\cp_mp\utility\script_utility::issharedfuncdefined( "hud", "showErrorMessage" ) )
        self [[ scripts\cp_mp\utility\script_utility::getsharedfunc( "hud", "showErrorMessage" ) ]]( var_1 );

    self playsoundtoplayer( "iw8_deployable_cover_plant_fail", self );

    if ( scripts\mp\equipment::_id_753F( "equip_tac_cover" ) )
        scripts\mp\equipment::_id_7DD2( "equip_tac_cover", 1 );
}

_id_EC9F()
{
    thread _id_EC96( 0 );
}

_id_ECB4( var_0, var_1, var_2, var_3 )
{
    self endon( "death_or_disconnect" );
    self endon( "tac_cover_taken" );
    level endon( "game_ended" );
    var_4 = anglestoforward( self.angles );
    var_5 = var_0._id_39B2 + ( 0, 90, 0 );
    var_6 = anglestoforward( var_5 );
    var_7 = vectordot( var_4, var_6 );
    var_8 = var_7 > 0;
    var_9 = var_0 _meth_872D();
    var_0 _id_099E::_id_4DF1( 1, "tac_cover_door" );

    if ( isdefined( var_1 ) )
        var_1 _id_099E::_id_4DF1( 1, "tac_cover_door" );

    var_10 = scripts\engine\utility::ter_op( var_8, ( 0, 90, 0 ), ( 0, -90, 0 ) );
    var_11 = ( 0, 0, -1 );
    var_12 = var_0._id_39B3 + var_11;
    var_13 = _func_0047( var_0._id_39B2, var_10 );
    var_14 = undefined;
    _id_ECB1( var_12, var_13, var_14, var_2, var_3, var_0, var_1 );
}

_id_ECB1( var_0, var_1, var_2, var_3, var_4, var_5, var_6 )
{
    self endon( "death_or_disconnect" );
    self endon( "tac_cover_taken" );
    level endon( "game_ended" );
    wait 0.05;
    var_0 = _id_EC90( var_0, var_1, var_4 );
    self notify( "tac_cover_spawned" );
    var_3 = istrue( var_3 );
    var_7 = spawn( "script_model", var_0 );
    var_7.angles = var_1;
    var_7.owner = self;
    var_7.team = self.team;
    var_7._id_DDEC = scripts\mp\equipment::_id_5ACA( "equip_tac_cover" );
    var_7._id_57AE = 1;
    var_7._id_8A5A = scripts\engine\utility::ter_op( var_3, 1, undefined );
    var_7._id_EB2E = level._id_EB28._id_E76A["super_tac_cover"]._id_7C71;
    var_7._id_10D06 = "s4_tac_cover_mp";
    var_7 _id_0765::_id_C2A7( 2, ::_id_EC9F );
    var_7 _id_07E9::_id_C2A4( "Tactical_Static", self );
    var_7 setentityowner( self );
    var_7 setotherent( self );
    var_7 setmodel( "wm_equip_gen_deployable_cover_00" );
    var_7 _meth_884D( 3, self.team );

    if ( isdefined( var_2 ) )
    {
        var_7 linkto( var_2 );
        var_7 thread _id_EC9E();
    }

    var_8 = _id_ECB2( var_7 );
    var_7 _meth_8745( var_8, level._id_ECE3 );
    var_7._id_3A3B = var_8;
    var_8._id_010F = var_7;
    var_8._id_A244 = 1;

    if ( isdefined( var_5 ) )
    {
        if ( isdefined( var_5._id_2572 ) )
            var_5._id_2572 _id_EC99();

        var_7._id_2567 = var_5;
        var_5._id_2572 = var_7;
    }

    if ( isdefined( var_6 ) )
    {
        var_7._id_2568 = var_6;
        var_6._id_2572 = var_7;
    }

    scripts\mp\weapons::_id_AABC( var_7, "equip_tac_cover", ::_id_EC99 );
    thread scripts\mp\weapons::_id_A0F2( self, var_7 );

    if ( var_3 )
    {
        var_7 thread _id_EC9B( self );
        var_7 thread _id_EC9D();
    }

    var_7 thread _id_EC9C();
    thread _id_ECB3( var_7 );
    thread scripts\mp\weapons::_id_ACC5( var_7 );
    var_7 _meth_86FB( "equipment" );

    if ( level.teambased )
        var_7 _meth_8703( self.team );
    else
        var_7 _meth_8703( self );

    var_7 thread _id_0A40::_id_CA27();
}

_id_ECB3( var_0 )
{
    var_0 endon( "death" );

    if ( 1 && 0 )
        var_0 _id_ECB0( 1 );

    wait( _id_ECA1() );

    if ( 1 && !0 )
        var_0 _id_ECB0( 1 );
}

_id_ECB2( var_0 )
{
    if ( !isdefined( level._id_ECE3 ) )
        return;

    var_1 = spawn( "script_model", var_0.origin );
    var_1 dontinterpolate();
    var_1.angles = var_0.angles;
    var_1 clonebrushmodeltoscriptmodel( level._id_ECE3 );
    var_1 linkto( var_0 );
    var_1 setentityowner( self );
    return var_1;
}

_id_EC99( var_0, var_1 )
{
    var_2 = 0;

    if ( !istrue( var_0 ) )
        var_2 = 0.2 + _id_ECA2();

    var_3 = self.maxhealth;

    if ( isdefined( self._id_013D ) && self._id_013D < self.maxhealth )
        var_3 = self._id_013D;

    self.owner _id_0793::_id_AAD4( "super_tac_cover", int( var_3 ) );
    _id_0780::_id_9751( self.owner, self._id_EB2E, int( var_3 ), istrue( var_1 ) );
    thread _id_EC9A( var_2 );
    thread _id_EC96( var_2 );
}

_id_EC9A( var_0 )
{
    if ( isdefined( self._id_2567 ) )
    {
        self._id_2567 _id_099E::_id_4DF1( 0, "tac_cover_door" );
        self._id_2567._id_2572 = undefined;
    }

    if ( isdefined( self._id_2568 ) )
    {
        self._id_2568 _id_099E::_id_4DF1( 0, "tac_cover_door" );
        self._id_2568._id_2572 = undefined;
    }

    if ( var_0 > 0 )
    {

    }

    if ( isdefined( self._id_3A3B ) )
        self._id_3A3B delete();
}

_id_EC96( var_0 )
{
    self notify( "death" );
    level._id_9ECB[self getentitynumber()] = undefined;
    var_1 = self.owner;

    if ( isdefined( var_1 ) )
        var_1 scripts\mp\weapons::_id_C48A( self );

    if ( 1 )
    {
        _id_079A::_id_A0ED();
        self _meth_8405();
    }

    if ( isdefined( self._id_3A3B ) )
        self._id_3A3B delete();

    wait( var_0 );
    self delete();
}

_id_EC9D()
{
    self endon( "death" );
    wait 150;
    _id_EC99( undefined, 0 );
}

_id_EC9C()
{
    self endon( "death" );
    level waittill( "game_ended" );
    _id_EC99( undefined, 0 );
}

_id_EC9E()
{
    self endon( "death" );

    while ( isdefined( self _meth_8151() ) )
        waitframe();

    _id_EC99( undefined, 0 );
}

_id_ECB0( var_0 )
{
    if ( 1 )
    {
        if ( var_0 )
        {
            var_1 = scripts\mp\utility\perk::_hasperk( "specialty_rugged_eqp" );
            var_2 = scripts\engine\utility::ter_op( var_1, 1250, 1000 );
            var_3 = "hitequip";
            thread _id_079A::_id_A0EC( var_2, var_3, ::_id_ECA7, ::_id_ECA6, 0 );
            self _meth_8406();
        }
        else
        {
            _id_079A::_id_A0ED();
            self _meth_8405();
        }
    }
}

_id_ECA6( var_0 )
{
    var_1 = _id_EC8F( var_0 );

    if ( isdefined( self.owner ) )
    {
        var_2 = max( self.maxhealth - self._id_013D, 0 );
        var_3 = min( var_2, var_1 );
        self.owner scripts\mp\supers::_id_3A9D( "super_tac_cover", var_3 );
    }

    return var_1;
}

_id_EC8F( var_0 )
{
    var_1 = var_0.attacker;
    var_2 = var_0.objweapon;
    var_3 = var_0._id_9CBF;
    var_4 = var_0.damage;
    var_5 = var_0._id_0317;

    if ( var_2.basename == "thermite_av_mp" )
        return 200.0;

    if ( var_2.basename == "thermite_bolt_radius_mp" )
        return 83.3333;

    if ( var_2.basename == "s4_throwing_knife_mp" )
        return 0;

    if ( var_2.basename == "s4_ar_stango44" && var_3 != "MOD_MELEE" )
        return 0;

    if ( var_3 == "MOD_IMPACT" && var_2.classname == "grenade" )
        return var_4;

    if ( var_3 == "MOD_CRUSH" && isdefined( var_0.inflictor ) && var_0.inflictor.classname == "script_vehicle" )
    {
        if ( isdefined( var_1 ) && !scripts\mp\weapons::_id_5F93( self.owner, var_1 ) )
            return var_4;
    }

    if ( _func_010E( var_0._id_9CBF ) )
        return 700.0;

    if ( var_3 == "MOD_MELEE" || var_3 == "MOD_IMPACT" )
        return 333.333;

    var_4 = _id_079A::_id_7401( var_2, var_3, var_4 );
    var_4 = _id_079A::_id_7476( var_2, var_3, var_4 );
    return var_4;
}

_id_ECA7( var_0 )
{
    var_1 = var_0.attacker;

    if ( istrue( scripts\cp_mp\utility\player_utility::_id_B779( self.owner, var_1 ) ) )
    {
        var_1 notify( "destroyed_equipment" );
        var_1 thread _id_0A76::_id_6FE6( "destroyed_equipment" );
        var_1 thread scripts\mp\battlechatter_mp::_id_553B( self );
        self.owner thread _id_0A64::_id_9120( "dc_destroyed_s" );
    }

    thread _id_EC99( undefined, 1 );
}

_id_EC97()
{
    if ( !isdefined( self._id_ECE5 ) )
    {
        var_0 = scripts\mp\equipment::_id_5ACA( "equip_tac_cover" );
        scripts\mp\equipment::_id_1513( var_0, 0, "equip_tac_cover" );
        scripts\common\utility::_id_1562( 0 );
        scripts\mp\utility\player::_id_151B( 0 );
        self._id_ECE5 = var_0;
    }
}

_id_EC98()
{
    if ( isdefined( self._id_ECE5 ) )
    {
        var_0 = self._id_ECE5;
        scripts\mp\equipment::_id_1513( var_0, 1, "equip_tac_cover" );
        scripts\common\utility::_id_1562( 1 );
        scripts\mp\utility\player::_id_151B( 1 );
        self._id_ECE5 = undefined;
    }
}

_id_ECA8( var_0 )
{
    var_1 = [ var_0 ];

    if ( isdefined( level._id_715A ) )
    {
        foreach ( var_3 in level._id_715A )
        {
            if ( isdefined( var_3 ) )
                var_1[var_1.size] = var_3;
        }
    }

    if ( isdefined( level._id_9F67 ) )
    {
        foreach ( var_6 in level._id_9F67 )
        {
            if ( isdefined( var_6 ) )
                var_1[var_1.size] = var_6;
        }
    }

    if ( isdefined( level._id_9ECB ) )
    {
        foreach ( var_9 in level._id_9ECB )
        {
            if ( !isdefined( var_9 ) )
                continue;

            var_10 = isdefined( var_9.owner ) && var_9.owner == var_0;
            var_11 = isdefined( var_9._id_5542 ) && var_9._id_5542 == "equip_tac_cover";
            var_12 = isdefined( var_9._id_5542 ) && var_9._id_5542 == "equip_ammo_box";

            if ( !var_10 && ( var_11 || var_12 ) )
                continue;

            var_1[var_1.size] = var_9;

            if ( isdefined( var_9._id_3A3B ) )
                var_1[var_1.size] = var_9._id_3A3B;
        }
    }

    return var_1;
}

_id_EC92( var_0 )
{
    if ( isplayer( var_0 ) )
        return 0;

    if ( var_0 _meth_8163() )
        return 0;

    if ( istrue( var_0._id_A1AD ) )
        return 0;

    if ( isdefined( var_0._id_010F ) && isdefined( var_0._id_010F._id_5542 ) && var_0._id_010F._id_5542 == "equip_tac_cover" )
        return 0;

    if ( var_0.classname == "misc_turret" )
        return 0;

    if ( var_0.classname == "script_vehicle" )
        return 0;

    return 1;
}

#using_animtree("scriptables");

_id_ECA1()
{
    return _func_0079( %wm_deployable_cover_deploy );
}

_id_ECA2()
{
    return 0;
}

_id_ECAB()
{
    return _id_ECAA( undefined, undefined, undefined, 1 );
}

_id_ECAE()
{
    _id_ECAD( undefined, undefined, 1 );
}

_id_EC9B( var_0 )
{
    self endon( "death" );
    var_0 endon( "tac_cover_taken" );
    var_0 scripts\engine\utility::waittill_any_2( "joined_team", "disconnect" );
    thread _id_EC99( undefined, 0 );
}
