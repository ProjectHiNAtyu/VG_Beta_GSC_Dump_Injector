// S4 GSC SOURCE
// Generated by https://github.com/xensik/gsc-tool

init()
{
    level._effect["mortar_initial_flare"] = loadfx( "vfx/iw8_mp/killstreak/vfx_white_phosphorus_expl_inair.vfx" );
    level._effect["mortar_impact"] = loadfx( "vfx/s4/killstreaks/vfx_bombingrun_exp_imp_lrg_01.vfx" );
    level._id_8DCC["mortar_barrage"] = spawnstruct();
    level._id_8DCC["mortar_barrage"]._id_47CD = makeweapon( "s4_binoculars_mp", [ "spotterscope" ] );
    scripts\mp\killstreaks\killstreaks::_id_C25C( "mortar_barrage", ::_id_F790 );
}

_id_F790( var_0 )
{
    if ( isdefined( level._id_8DD2 ) )
    {
        if ( !level [[ level._id_8DD2 ]]( var_0 ) )
        {
            scripts\cp_mp\vehicles\vehicle_tracking::_id_396E();
            return 0;
        }
    }

    if ( isdefined( level._id_8DAD ) )
    {
        if ( !level [[ level._id_8DAD ]]( var_0 ) )
        {
            scripts\cp_mp\vehicles\vehicle_tracking::_id_396E();
            return 0;
        }
    }

    self._id_BC5D = self getcurrentweapon();
    var_1 = makeweapon( "s4_ks_flare_canister_mp" );
    var_2 = _id_0990::_id_EA00( var_0, var_1, "grenade_fire", ::_id_10D91, ::_id_10DDE, ::_id_10D7F );

    if ( isdefined( var_2 ) && !var_2 )
    {
        if ( scripts\cp_mp\utility\script_utility::issharedfuncdefined( "sound", "trySayLocalSound" ) )
            [[ scripts\cp_mp\utility\script_utility::getsharedfunc( "sound", "trySayLocalSound" ) ]]( self, "use_mortar_fail" );

        return 0;
    }

    var_3 = self._id_5C37.origin;

    if ( !isdefined( var_3 ) )
    {
        if ( scripts\cp_mp\utility\script_utility::issharedfuncdefined( "sound", "trySayLocalSound" ) )
            [[ scripts\cp_mp\utility\script_utility::getsharedfunc( "sound", "trySayLocalSound" ) ]]( self, "use_mortar_fail" );

        return 0;
    }

    var_4 = _id_688F( var_3, 300.0 );
    thread _id_90E5( var_3, var_4 );

    if ( scripts\cp_mp\utility\script_utility::issharedfuncdefined( "hud", "teamPlayerCardSplash" ) )
        [[ scripts\cp_mp\utility\script_utility::getsharedfunc( "hud", "teamPlayerCardSplash" ) ]]( "used_mortar_barrage", self );

    if ( scripts\cp_mp\utility\script_utility::issharedfuncdefined( "sound", "playKillstreakDeployDialog" ) )
        [[ scripts\cp_mp\utility\script_utility::getsharedfunc( "sound", "playKillstreakDeployDialog" ) ]]( self, var_0._id_EA0F );

    return 1;
}

_id_688F( var_0, var_1 )
{
    var_2 = [];

    for ( var_3 = 0; var_3 < 24; var_3++ )
    {
        var_4 = randomint( 360 );
        var_5 = randomfloat( var_1 );
        var_2[var_3] = var_0 + rotatevector( ( 1, 0, 0 ), ( 0, var_4, 0 ) ) * var_5;
    }

    return var_2;
}

burnatorigin( var_0 )
{
    self endon( "end_flare_burn" );

    for (;;)
    {
        foreach ( var_2 in level.players )
        {
            if ( distance( var_2.origin, var_0 ) < 60 )
                var_2 dodamage( 2, var_0, self, undefined, "MOD_FIRE" );
        }

        wait 0.2;
    }
}

_id_90E5( var_0, var_1 )
{
    thread burnatorigin( var_0 );
    wait 8.0;
    self notify( "end_flare_burn" );
    var_2 = ( 0, 0, -750 );

    foreach ( var_4 in var_1 )
    {
        var_5 = var_4 + ( 0, 0, 1500 );
        thread _id_501E( var_5, var_2 );
        var_6 = randomfloatrange( 0.7, 2.0 );
        wait( var_6 );
    }

    self notify( "mortar_barrage_ended" );
}

_id_501E( var_0, var_1 )
{
    var_2 = magicgrenademanual( "s4_ks_mortar_mp", var_0, var_1, 10, self );
    var_2.angles = vectortoangles( ( 0, 0, -1 ) );
    var_2 setmissileminimapvisible( 1 );
    var_2 setentityowner( self );
    var_2 setotherent( self );
    var_2._id_5798 = spawn( "script_model", var_2.origin );
    var_2._id_5798 linkto( var_2 );
    var_2._id_5798 dontinterpolate();
    var_2._id_5798 setentityowner( self );
    var_3 = spawn( "script_model", var_0 );
    var_3 linkto( var_2, "tag_origin", ( 10, 0, 10 ), ( 0, 0, 0 ) );
    var_2.killcament = var_3;
    var_2.owner = self;
    thread _id_0823::_id_A15B( var_2 );
    var_2 thread _id_A196( vectortoangles( var_1 ), gettime(), var_1 );
}

_id_A196( var_0, var_1, var_2 )
{
    self endon( "death" );
    self endon( "missile_dest_failed" );
    self waittill( "missile_stuck", var_3 );
    self setmissileminimapvisible( 0 );
    self hide();
    wait 0.05;
    var_4 = -1 * getdvarint( "#x3f7e9b59e29bb9d7e", 800 );
    var_5 = ( gettime() - var_1 ) / 1000;
    var_6 = var_2 + ( 0, 0, var_4 * var_5 );
    thread _id_A17F( self.origin );
}

_id_A17F( var_0 )
{
    self endon( "death" );
    self._id_57AE = 1;
    self._id_5798 unlink();
    self._id_5798.origin = var_0;
    playfx( level._effect["mortar_impact"], var_0 );
    self radiusdamage( var_0, 550.0, 125, 40, self.owner, "MOD_EXPLOSIVE", self._id_10D06 );
    thread _id_0823::_id_A15A( var_0 );
    thread _id_07EB::_id_7127( var_0, 1.25 );
    scripts\cp_mp\hostmigration::hostmigration_waitlongdurationwithpause( 0.5 );

    if ( isdefined( self._id_5798 ) )
        self._id_5798 delete();

    self delete();
}

_id_10D91( var_0 )
{
    return 1;
}

_id_10DDE( var_0, var_1 )
{
    var_0 endon( "killstreak_finished_with_deploy_weapon" );
    self allowfire( 0 );
    self notifyonplayercommand( "flare_cannister_use", "+frag" );
    self notifyonplayercommand( "flare_cannister_use", "+attack" );
    self notifyonplayercommand( "flare_cannister_use", "+speed_throw" );

    if ( istrue( var_1 ) )
    {
        thread _id_10BE7( var_0 );

        for (;;)
        {
            self waittill( "flare_cannister_use" );
            var_2 = self.origin + anglestoforward( self.angles ) * 147;

            if ( _id_333D( var_2, var_2 + ( 0, 0, 10000 ) ) )
            {
                scripts\mp\hud_message::_id_DC9F( "KILLSTREAKS/MORTAR_BARRAGE_INVALID_PLACEMENT" );
                waitframe();
                continue;
            }

            self allowfire( 1 );
            self switchtoweaponimmediate( self._id_BC5D );
            self notify( "flare_cannister_used" );
            return;
        }
    }
}

_id_10BE7( var_0 )
{
    self endon( "flare_cannister_used" );
    self endon( "disconnect" );
    self notifyonplayercommand( "cancel_deploy", "+actionslot 3" );
    var_1 = scripts\engine\utility::_id_10895( "cancel_deploy", "weapon_switch_started" );

    if ( !isdefined( var_1 ) )
        return;

    self allowfire( 1 );
    var_0 notify( "killstreak_finished_with_deploy_weapon" );
    self notify( "cancel_all_killstreak_deployments" );
}

_id_10AEB( var_0 )
{
    self endon( "death_or_disconnect" );
    self endon( "deploy_cancelled" );
    self endon( "deploy_fired" );
    var_1 = spawn( "script_model", self.origin );
    var_1 setmodel( "ks_airstrike_marker_mp" );
    var_1._id_A8F5 = _id_07D0::_id_C56F( 99 );
    var_1 setotherent( self );
    var_1 dontinterpolate();
    var_1 hide();
    var_2 = "hud_icon_killstreak_tomastrike";
    var_1 _id_D5E5( var_1._id_A8F5, var_2, self, 50 );
    var_1 thread _id_10BC2( self );
    var_1 thread _id_10AC3( self );
    var_1 thread _id_10AC5( self );
    var_1._id_FCB7 = 0;
    scripts\common\utility::_id_1516( 0 );

    for (;;)
    {
        if ( _id_0764::_id_8599() && istrue( var_1._id_FCB7 ) )
        {
            scripts\common\utility::_id_1516( 0 );
            var_1 hide();
            self notify( "stop_update_marker" );
            var_1._id_FCB7 = 0;
        }

        var_3 = self playerads();

        if ( var_3 == 1 && !istrue( var_1._id_FCB7 ) )
        {
            if ( !_id_0764::_id_8599() )
            {
                scripts\common\utility::_id_1516( 1 );
                var_1 show();
                var_1 thread _id_FCB8( self );
                var_1._id_FCB7 = 1;
            }
        }
        else if ( var_3 < 1 && istrue( var_1._id_FCB7 ) )
        {
            scripts\common\utility::_id_1516( 0 );
            var_1 hide();
            self notify( "stop_update_marker" );
            var_1._id_FCB7 = 0;
        }

        waitframe();
    }
}

_id_D5E5( var_0, var_1, var_2, var_3 )
{
    _func_015B( var_0, var_1 );
    _func_0187( var_0 );
    _func_0180( var_0, var_2 );
    _func_015C( var_0, self );
    _func_015D( var_0, var_3 );
    _func_016D( var_0, 0 );
    _func_016E( var_0, 0 );
    _func_0175( var_0, 1 );

    if ( level.teambased )
        _func_017D( var_0, var_2.team );
    else
        _func_017C( var_0, var_2 );

    _func_0166( var_0, "done" );
}

_id_10BC2( var_0 )
{
    self endon( "death" );
    level endon( "game_ended" );
    var_0 waittill( "death_or_disconnect" );
    _id_C4D6();
}

_id_C4D6( var_0 )
{
    if ( isdefined( var_0 ) )
    {
        self endon( "death" );
        level endon( "game_ended" );
        scripts\cp_mp\hostmigration::hostmigration_waitlongdurationwithpause( var_0 );
    }

    if ( isdefined( self._id_A8F5 ) )
        _id_07D0::_id_C78C( self._id_A8F5 );

    self delete();
}

_id_10AC3( var_0 )
{
    var_0 endon( "death_or_disconnect" );
    self endon( "death" );
    level endon( "game_ended" );
    var_1 = var_0 scripts\engine\utility::_id_10895( "cancel_fire", "successful_fire" );

    if ( isdefined( var_1 ) && var_1 == "successful_fire" )
    {
        var_0 notify( "deploy_fired" );
        var_2 = anglestoforward( var_0 getplayerangles() );
        var_3 = self.origin - var_2 * 500;
        var_4 = self.origin + var_2 * 20;
        var_5 = scripts\engine\trace::ray_trace( var_3, var_4, self );
        var_6 = var_5["normal"];
        self.angles = _func_0311( var_6, self.angles );
        _func_0166( self._id_A8F5, "current" );
        thread _id_C4D6( 48.0 );
    }
    else
    {
        var_0 notify( "deploy_cancelled" );

        if ( !var_0 scripts\mp\utility\player::_id_896F() )
            var_0 scripts\common\utility::_id_1516( 1 );

        _id_C4D6();
    }
}

_id_10AC5( var_0 )
{
    var_0 endon( "death_or_disconnect" );
    self endon( "death" );
    level endon( "game_ended" );
    var_1 = var_0 getcurrentweapon();

    for (;;)
    {
        if ( var_0 getcurrentweapon() != var_1 )
            break;

        waitframe();
    }

    var_0 notify( "cancel_fire" );
}

_id_10D7F( var_0, var_1, var_2 )
{
    self._id_5C37 = var_2;
    _id_1D21( var_2 );
    return "success";
}

_id_FCB8( var_0 )
{
    self endon( "death" );
    var_0 endon( "deploy_cancelled" );
    var_0 endon( "deploy_fired" );
    var_0 endon( "stop_update_marker" );
    var_0 endon( "death_or_disconnect" );
    var_1 = 0;
    var_0 setclientomnvar( "ui_spotter_scope_danger", 0 );

    for (;;)
    {
        var_2 = _id_6BE2( var_0 );
        var_3 = -1;
        var_4 = -1;
        var_5 = -1;

        if ( isdefined( var_2 ) )
        {
            self.origin = var_2;
            var_3 = int( self.origin[0] );
            var_4 = int( self.origin[1] );
            var_5 = int( self.origin[2] );
        }

        var_0 setclientomnvar( "ui_ac130_coord3_posx", var_3 );
        var_0 setclientomnvar( "ui_ac130_coord3_posy", var_4 );
        var_0 setclientomnvar( "ui_ac130_coord3_posz", var_5 );

        if ( isdefined( var_2 ) )
        {
            if ( !istrue( var_1 ) && distance2dsquared( var_0.origin, var_2 ) <= 1638400 )
            {
                var_0 setclientomnvar( "ui_spotter_scope_danger", 1 );
                var_1 = 1;
            }
            else if ( istrue( var_1 ) && distance2dsquared( var_0.origin, var_2 ) > 1638400 )
            {
                var_0 setclientomnvar( "ui_spotter_scope_danger", 0 );
                var_1 = 0;
            }
        }

        waitframe();
    }
}

_id_6BE2( var_0 )
{
    var_1 = [ "physicscontents_clipshot", "physicscontents_missileclip", "physicscontents_vehicleclip" ];
    var_2 = physics_createcontents( var_1 );
    var_3 = var_0 getvieworigin();
    var_4 = var_3 + anglestoforward( var_0 getplayerangles() ) * 50000;
    var_5 = var_0 scripts\cp_mp\utility\killstreak_utility::_id_B6EF();
    var_6 = scripts\engine\trace::ray_trace( var_3, var_4, var_5, var_2 );
    var_7 = var_6["position"];

    if ( var_6["hittype"] == "hittype_none" )
        var_7 = undefined;

    return var_7;
}

_id_D062( var_0 )
{
    var_1 = undefined;
    var_2 = undefined;
    var_3 = undefined;
    var_4 = undefined;
    var_5 = "used_" + var_0._id_EA0F;
    var_1 = _id_6BE2( self );
    var_0 notify( "killstreak_finished_with_deploy_weapon" );
    self notify( "successful_fire" );
    thread scripts\mp\hud_util::_id_EF8A( var_5, self );
    _id_07C5::_id_978D( var_0._id_EA0F, var_1 );
    return var_1;
}

_id_1D21( var_0 )
{
    self endon( "disconnect" );
    var_0 endon( "death" );
    var_0 _id_0765::_id_C2A7( 2, ::_id_4753 );
    thread scripts\mp\weapons::_id_A0F3( self, var_0 );
    var_0 waittill( "missile_stuck", var_1 );

    if ( isdefined( var_1 ) )
        var_0 linkto( var_1 );

    thread _id_1D1C( var_0 );
    return 1;
}

_id_1D1C( var_0 )
{
    var_0 endon( "mine_destroyed" );
    var_0 endon( "death" );
    var_0 setotherent( self );
    var_0 setentityowner( self );
    var_0 _meth_85B7();
    var_0 _meth_85B8();
    var_0 _meth_8357( 1 );
    thread scripts\mp\weapons::_id_ACC5( var_0 );
    wait 1;
    var_0._id_5C32 = _func_03C0( "ks_white_phosphorus_mp_p", var_0.origin, var_0.angles );
    var_0._id_5C32 setscriptablepartstate( "flare", "on", 0 );
    wait 8.0;
    var_0._id_5C32 setscriptablepartstate( "flare", "off", 0 );
    var_0._id_5C32 setscriptablepartstate( "flare_death", "on", 0 );
    self waittill( "mortar_barrage_ended" );
    wait 3;
    var_0 _id_4753();
}

_id_4753()
{
    self._id_5C37 = undefined;
    self delete();
}

_id_333D( var_0, var_1 )
{
    var_2 = scripts\engine\trace::ray_trace( var_0, var_1 );

    if ( isdefined( var_2 ) )
    {
        var_3 = var_2["position"];
        var_4 = var_2["normal"];
        return var_3 != var_1;
    }

    return 1;
}
