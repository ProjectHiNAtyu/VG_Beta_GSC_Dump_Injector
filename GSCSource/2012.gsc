// S4 GSC SOURCE
// Generated by https://github.com/xensik/gsc-tool

init()
{
    if ( scripts\mp\utility\game::getgametype() == "br" || istrue( game["isLaunchChunk"] ) )
    {
        level._id_BA7D = 0;
        return;
    }

    if ( !isdefined( level._id_BA7D ) || level._id_BA7D )
        level._id_BA7D = level._id_5A87 == 1;

    if ( !level._id_BA7D )
        return;

    var_0 = spawnstruct();
    level._id_BA7E = var_0;
    var_0._id_4121 = undefined;
    var_0._id_EC4A = 0;
    var_0._id_54CF = [];
    var_0._id_D71E = [];
    var_0._id_D720 = [];
    var_0._id_A4BF = 0;
    var_0._id_8F75 = -1;
    var_0._id_AF70 = 0;
    _id_95FD();
    setdvarifuninitialized( "#x3438da3956879c21", 5000 );
    setdvarifuninitialized( "#x35805e05dfd2245d7", 3000 );
    setdvarifuninitialized( "#x32ebcc0d172f2f174", 1000 );
    setdvarifuninitialized( "#x3f5c43063fe0f37ed", 1 );
    setdvarifuninitialized( "#x32fa12d8b14255fd5", 420 );
    thread _id_AB46();
    _id_0A65::_id_C277( ::_id_AB50 );
    _id_07DD::init();
}

_id_6B3C()
{
    return getdvarint( "#x32fa12d8b14255fd5" );
}

_id_6860()
{
    return getdvarint( "#x3438da3956879c21" );
}

_id_6861()
{
    return getdvarint( "#x35805e05dfd2245d7" );
}

_id_6CE7()
{
    return getdvarint( "#x32ebcc0d172f2f174" );
}

_id_6E7A()
{
    return _id_6861() + _id_6CE7() * 2;
}

_id_6E79()
{
    return _id_6860() + _id_6CE7() * 2;
}

_id_6B3D()
{
    return getdvarint( "potg_min_nVidia_highlights_score" );
}

_id_95FD()
{
    var_0 = level._id_BA7E;
    var_1 = 0;

    for (;;)
    {
        var_2 = tablelookupbyrow( "mp/potg_event_table.csv", var_1, 0 );

        if ( !isdefined( var_2 ) || var_2 == "" )
            break;

        var_0._id_56A3[var_2] = [];
        var_3 = tablelookupbyrow( "mp/potg_event_table.csv", var_1, 1 );
        var_0._id_56A3[var_2]["score"] = float( var_3 );
        var_4 = tablelookupbyrow( "mp/potg_event_table.csv", var_1, 2 );
        var_0._id_56A3[var_2]["addOn"] = var_4 != "";
        var_1++;
    }
}

_id_AB46()
{
    level endon( "game_ended" );

    for (;;)
    {
        level waittill( "connected", var_0 );
        _id_C291( var_0 );
        var_0 thread _id_FCFC();
    }
}

_id_FCFC()
{
    level endon( "game_ended" );
    self endon( "disconnect" );

    for (;;)
    {
        self waittill( "spawned_player" );
        _id_E719();
        self waittill( "death" );

        if ( !istrue( self._id_59C0 ) )
            self waittill( "death_delay_finished" );

        _id_E934();
    }
}

_id_AB50( var_0 )
{
    _id_47E4( var_0 );
}

_id_AB7F( var_0 )
{
    if ( !istrue( level._id_BA7D ) )
        return;

    _id_07DD::_id_AB7F( var_0 );
    waitframe();
    thread _id_10820();
}

_id_10820()
{
    wait( _id_6CE7() / 1000.0 );
    waitframe();

    if ( !_id_DBD5() )
        _id_5A7E();
}

_id_DBD5()
{
    var_0 = _id_697E();

    if ( isdefined( var_0 ) && isdefined( var_0._id_BCC0 ) )
        return var_0._id_0369 < _id_6B3C();
    else
        return 1;
}

_id_5A7E()
{
    level notify( "potg_finalize" );
    _id_5A7B();
    waittillframeend;

    if ( _id_DBD5() )
        return;

    level._id_BA7E._id_EC4A = 1;

    if ( level._id_BA7E._id_AF70 )
        _id_1A16();

    var_0 = _id_697E();

    if ( isdefined( var_0 ) )
        _id_5A7F( var_0 );
}

_id_8A6E()
{
    return level._id_BA7E._id_EC4A;
}

_id_C291( var_0 )
{
    if ( !level._id_BA7D )
        return;

    var_1 = level._id_BA7E;
    var_2 = _id_69ED( var_0 );
    var_3 = spawnstruct();
    var_3._id_0186 = var_0;
    var_3._id_569C = [];
    var_3._id_C139 = 0;
    var_3._id_901F = -1;
    var_3._id_A48A = 0;
    var_1._id_54CF[var_2] = var_3;
}

_id_47E4( var_0 )
{
    if ( !level._id_BA7D )
        return;

    var_1 = level._id_BA7E;
    var_2 = _id_69ED( var_0 );
    var_1._id_54CF[var_2] = undefined;
    var_0 notify( "cleanup_potg_entity" );
}

_id_69EE( var_0 )
{
    var_1 = _id_69ED( var_0 );
    return level._id_BA7E._id_54CF[var_1];
}

_id_69ED( var_0 )
{
    if ( isdefined( var_0._id_BA7F ) )
        return var_0._id_BA7F;

    var_0._id_BA7F = var_0 getentitynumber();
    return var_0._id_BA7F;
}

_id_E719()
{
    if ( !level._id_BA7D )
        return;

    if ( _id_8A6E() )
        return;

    var_0 = _id_69EE( self );

    if ( var_0._id_C139 == 0 )
        _id_AB73( var_0 );

    var_0._id_C139++;
}

_id_AB73( var_0 )
{
    var_0._id_901F = gettime();
}

_id_E934()
{
    if ( !level._id_BA7D )
        return;

    if ( _id_8A6E() )
        return;

    var_0 = _id_69EE( self );
    var_0._id_C139--;

    if ( var_0._id_C139 == 0 )
        _id_AB74( var_0 );
}

_id_5EAB( var_0 )
{
    var_0._id_C139 = 0;
    var_0._id_0186 _id_AB74( var_0 );
}

_id_AB74( var_0 )
{
    var_1 = level._id_BA7E;
    _id_07DD::_id_AB6B();
    var_0._id_0186 notify( "potg_stop_recording" );
    _id_C460( var_0 );
}

_id_89D8( var_0 )
{
    if ( !level._id_BA7D )
        return 0;

    if ( _id_8A6E() )
        return 0;

    if ( !isdefined( var_0 ) )
        var_0 = _id_69EE( self );

    return var_0._id_C139 > 0;
}

_id_5A7B()
{
    var_0 = level._id_BA7E;

    foreach ( var_2 in var_0._id_54CF )
        _id_5EAB( var_2 );
}

_id_BD5E( var_0, var_1, var_2, var_3, var_4, var_5 )
{
    if ( !level._id_BA7D )
        return;

    if ( !isdefined( var_1 ) )
        var_1 = gettime();

    if ( !isdefined( var_2 ) )
        var_2 = var_1;

    var_6 = level._id_BA7E;
    var_7 = _id_69EE( self );
    _id_C4E8( var_7 );

    if ( !_id_89D8( var_7 ) )
        return;

    var_8 = int( max( _id_6995(), var_7._id_901F ) );

    if ( var_1 <= var_8 || var_2 <= var_8 )
        return;

    var_9 = spawnstruct();
    var_10 = undefined;

    if ( isdefined( var_4 ) )
        var_10 = var_4;
    else
        var_10 = _id_56A4( var_0 );

    if ( isdefined( var_5 ) )
        var_10 = var_10 * var_5;

    var_9._id_569B = var_0;
    var_9._id_E72A = var_1;
    var_9._id_532E = var_2;
    var_9._id_0369 = var_10;
    var_9._id_032E = var_3;
    var_11 = var_7._id_A48A;
    var_7._id_A48A++;
    var_7._id_569C[var_11] = var_9;
    _id_433D( var_9, var_11, self );

    if ( !_id_56A5( var_0 ) )
        thread _id_107D8( var_7 );
}

_id_107D8( var_0 )
{
    var_1 = var_0._id_0186;
    var_1 endon( "disconnect" );
    var_1 endon( "cleanup_potg_entity" );
    var_1 notify( "waitAndNominatePOTG()" );
    var_1 endon( "waitAndNominatePOTG()" );
    waittillframeend;

    if ( !_id_89D8( var_0 ) )
        return;

    var_2 = _id_2ECD( var_0._id_569C );

    if ( var_2 > _id_6B3D() && var_1 _meth_8683() )
    {

    }

    if ( var_2 > _id_6B3C() && var_2 > _id_68F3() )
    {
        var_3 = _id_401F( var_0, var_2 );
        var_1 thread _id_1080F( var_3 );
    }
    else
    {

    }
}

_id_C4E8( var_0 )
{
    var_1 = _id_6995();

    foreach ( var_4, var_3 in var_0._id_569C )
    {
        if ( var_3._id_E72A < var_1 )
            var_0._id_569C[var_4] = undefined;
    }
}

_id_C460( var_0 )
{
    var_0._id_569C = [];
}

_id_401F( var_0, var_1 )
{
    var_2 = spawnstruct();
    var_2._id_BCC0 = var_0._id_0186;
    var_2._id_569C = var_0._id_569C;
    var_2._id_0369 = var_1;
    var_2._id_CBC2 = level._id_BA7E._id_A4BF;
    level._id_BA7E._id_A4BF++;
    var_2._id_0E6B = undefined;
    var_2._id_0E60 = undefined;

    foreach ( var_4 in var_0._id_569C )
    {
        if ( !isdefined( var_2._id_0E6B ) || var_4._id_E72A < var_2._id_0E6B )
            var_2._id_0E6B = var_4._id_E72A;

        if ( !isdefined( var_2._id_0E60 ) || var_4._id_532E > var_2._id_0E60 )
            var_2._id_0E60 = var_4._id_532E;
    }

    var_2._id_C13A = var_0._id_901F;
    var_2._id_532E = undefined;
    var_2._id_B351 = undefined;
    var_2._id_B350 = undefined;
    return var_2;
}

_id_4C5B( var_0 )
{
    return _id_6B2B( var_0 ) >= _id_6E7A();
}

_id_4C5A( var_0 )
{
    return var_0._id_532E - var_0._id_0E60 >= _id_6CE7();
}

_id_6B2B( var_0 )
{
    var_1 = var_0._id_C13A;
    return var_0._id_532E - var_0._id_C13A;
}

_id_1080F( var_0 )
{
    self endon( "disconnect" );
    self endon( "cleanup_potg_entity" );
    var_1 = var_0._id_C13A + _id_6E7A();
    var_2 = var_0._id_0E60 + _id_6CE7();
    var_3 = var_0._id_0E6B + _id_6E79();
    var_4 = int( clamp( var_2, var_1, var_3 ) );
    var_5 = "no_wait";

    if ( var_4 > gettime() )
    {
        thread _id_10BCA( var_4 );
        var_5 = scripts\engine\utility::_id_1089D( "potg_pending_scene_timeout", "potg_stop_recording" );
        self notify( "potg_scene_finished_pending" );
    }

    if ( gettime() > var_4 )
        var_0._id_532E = var_4;
    else
        var_0._id_532E = gettime();

    if ( _id_4C5B( var_0 ) )
    {
        if ( _id_4C5A( var_0 ) )
        {
            if ( var_0._id_0369 > _id_6B3C() && var_0._id_0369 >= _id_68F3() )
                _id_D4E6( var_0 );
            else
            {

            }
        }
        else
        {

        }
    }
    else
    {

    }
}

_id_10BCA( var_0 )
{
    self endon( "potg_scene_finished_pending" );

    while ( gettime() < var_0 )
        waitframe();

    self notify( "potg_pending_scene_timeout" );
}

_id_2ECD( var_0 )
{
    var_1 = 0;
    var_2 = 0;

    foreach ( var_4 in var_0 )
    {
        var_2 = var_2 + var_4._id_0369;

        if ( var_4._id_569B == "kill" )
            var_1++;
    }

    if ( var_1 > 2 )
    {
        var_6 = _id_56A4( "triple_kill" );
        var_2 = var_2 + var_6;
    }

    return var_2;
}

_id_D4E6( var_0 )
{
    _id_2E9D( var_0 );
    _id_C55D( var_0._id_B351, var_0._id_B350 );
    _id_CC62( var_0, level._id_BA7E._id_4121 );
    level._id_BA7E._id_4121 = var_0;
}

_id_697E()
{
    if ( !level._id_BA7D )
        return undefined;

    return level._id_BA7E._id_4121;
}

_id_68F3()
{
    if ( !level._id_BA7D )
        return -1;

    var_0 = level._id_BA7E;

    if ( !isdefined( var_0._id_4121 ) )
        return -1;

    return var_0._id_4121._id_0369;
}

_id_6995()
{
    return gettime() - _id_6E79();
}

_id_56A4( var_0 )
{
    return level._id_BA7E._id_56A3[var_0]["score"];
}

_id_56A5( var_0 )
{
    return level._id_BA7E._id_56A3[var_0]["addOn"];
}

_id_56A6( var_0 )
{
    return isdefined( level._id_BA7E._id_56A3[var_0] );
}

_id_5A7F( var_0 )
{
    var_0._id_5A7C = 1;
    _id_2E9E( var_0 );
    _id_C631();
    _id_433E( var_0 );
}

_id_C631()
{
    foreach ( var_1 in level.players )
    {
        var_1 setclientomnvar( "ui_potg_score_event_control", -1 );
        var_1 setclientomnvar( "ui_score_event_list_0", -1 );
        var_1 setclientomnvar( "ui_score_event_list_1", -1 );
        var_1 setclientomnvar( "ui_score_event_list_2", -1 );
        var_1 setclientomnvar( "ui_score_event_list_3", -1 );
        var_1 setclientomnvar( "ui_score_event_list_4", -1 );
    }
}

_id_2E9D( var_0 )
{
    var_1 = gettime() - 13000;
    var_2 = var_0._id_532E - _id_6E79();
    var_3 = int( max( var_2, max( var_0._id_C13A, var_1 ) ) );
    var_4 = var_0._id_0E6B - _id_6CE7();
    var_5 = int( min( var_0._id_0E6B, var_0._id_532E - _id_6E7A() ) );
    var_0._id_B351 = int( clamp( var_4, var_3, var_5 ) );
    var_0._id_B350 = var_0._id_532E;
    var_6 = var_0._id_B350 - var_0._id_B351;
}

_id_2E9E( var_0 )
{
    var_1 = [];

    foreach ( var_3 in var_0._id_569C )
    {
        if ( isdefined( var_3._id_032E ) && !isdefined( var_1[var_3._id_532E] ) )
            var_1[var_3._id_532E] = var_3._id_032E;
    }

    if ( var_1.size <= 0 )
    {
        var_0._id_032E = 0;
        return;
    }

    var_5 = 0.0;

    foreach ( var_7 in var_1 )
        var_5 = var_5 + var_7;

    var_9 = var_5 / var_1.size;
    var_0._id_032E = int( var_9 );
}

_id_6A18()
{
    var_0 = _id_697E();

    if ( !isdefined( var_0 ) )
        return undefined;

    var_1 = spawnstruct();
    var_1._id_E72A = var_0._id_B351;
    var_1._id_532E = var_0._id_B350;
    var_1._id_E3DE = var_0._id_BCC0;
    var_1._id_032E = var_0._id_032E;
    return var_1;
}

_id_C55D( var_0, var_1 )
{
    level thread _id_1A18( var_0, var_1 );
}

_id_1A18( var_0, var_1 )
{
    level endon( "potg_finalize" );
    level notify( "potg_archiveRequestHelper()" );
    level endon( "potg_archiveRequestHelper()" );
    level._id_BA7E._id_AF70 = 1;
    var_2 = var_0 + 13000 - 100;
    var_3 = var_2 - gettime();
    scripts\engine\utility::_id_107AC( var_3 );
    level._id_BA7E._id_AF70 = 0;
    _id_1A16();
}

_id_1A16()
{
    thread _id_4494( _func_0395(), _id_697E() );
    _func_0394();
    var_0 = level._id_BA7E._id_8F75;
    level._id_BA7E._id_8F75 = gettime();
    var_1 = -1;

    if ( var_0 > 0 )
        var_1 = level._id_BA7E._id_8F75 - var_0;
}

_id_6CC3()
{
    return 13000 - _id_6E79() - 250;
}

_id_4C59( var_0 )
{
    var_1 = level._id_BA7E._id_8F75;

    if ( var_1 < 0 )
        return 0;

    var_2 = var_1 - 13000;
    return var_0._id_B351 >= var_2 && var_0._id_B350 <= var_1;
}

_id_CC62( var_0, var_1 )
{
    if ( getdvarint( "potg_screen_prints" ) == 0 )
        return;

    if ( var_0._id_0369 <= 250 )
        return;

    var_2 = undefined;

    if ( isplayer( var_0._id_BCC0 ) )
        var_2 = var_0._id_BCC0.name;
    else
        var_2 = "(GameObject)";

    if ( isplayer( var_0._id_BCC0 ) )
        var_0._id_BCC0 iprintlnbold( "POTG Nominee! (" + var_0._id_0369 + ")" );

    if ( isdefined( var_1 ) && isplayer( var_1._id_BCC0 ) && var_1._id_BCC0 != var_0._id_BCC0 )
        var_1._id_BCC0 iprintlnbold( "Your POTG was bested by +" + var_2 + "! (" + var_0._id_0369 + ")" );

    level._id_BA7E._id_8F93 = gettime();
}

_id_CC61()
{
    if ( getdvarint( "potg_screen_prints" ) == 0 )
        return;

    var_0 = _id_697E();
    var_1 = gettime() - int( self._id_005F * 1000 );
    var_2 = 0.15;
    var_3 = [];

    for (;;)
    {
        foreach ( var_6, var_5 in var_0._id_569C )
        {
            if ( var_5._id_E72A <= var_1 && !isdefined( var_3[var_6] ) )
            {
                iprintlnbold( var_5._id_569B );
                iprintln( var_5._id_569B );
                var_3[var_6] = 1;
                break;
            }
        }

        wait( var_2 );
        var_1 = var_1 + int( var_2 * 1000 );
    }
}

_id_433B()
{
    if ( getdvarint( "scr_playtest_qa", 0 ) != 0 )
        return -1;

    if ( getdvarint( "scr_playtest", 0 ) != 0 )
        return 9;

    return -1;
}

_id_433C()
{
    return getdvarint( "potg_datalog" ) != 0;
}

_id_433E( var_0 )
{
    if ( !_id_433C() )
        return;

    var_1 = _id_433B();
    _func_03BA( "mpscript_potg", [ "score", var_0._id_0369, "duration", var_0._id_B350 - var_0._id_B351, "start_time", var_0._id_B351, "action_start_offset", var_0._id_0E6B - var_0._id_B351, "action_end_offset", var_0._id_0E60 - var_0._id_B351, "entity_id", _id_69ED( var_0._id_BCC0 ), "script_version", var_1 ] );

    foreach ( var_3 in var_0._id_569C )
        _func_03BA( "mpscript_potg_final_events", [ "event_ref", var_3._id_569B, "score", var_3._id_0369, "start_time", var_3._id_B351, "end_time", var_3._id_B350, "script_version", var_1 ] );
}

_id_433D( var_0, var_1, var_2 )
{
    if ( !_id_433C() )
        return;

    _func_03BA( "mpscript_potg_events", [ "event_ref", var_0._id_569B, "score", var_0._id_0369, "start_time", var_0._id_E72A, "end_time", var_0._id_532E, "event_id", var_1, "entity_id", _id_69ED( var_2 ), "script_version", _id_433B() ] );
}

_id_433A( var_0, var_1, var_2, var_3, var_4 )
{
    if ( getdvarint( "#x3f5c43063fe0f37ed", 0 ) == 0 )
        return;

    var_5 = _id_433B();
    _func_03BA( "mpscript_potg_archive", [ "requestTime", var_0, "archiveStartTime", var_1, "archiveDuration", var_2, "desiredSceneStartTime", var_3, "desiredSceneEndTime", var_4, "playerCount", level.players.size, "tickRate", int( 1.0 / level._id_5F1B ), "dedi", scripts\engine\utility::ter_op( _func_010A(), 1, 0 ), "version", 0 ] );
}

_id_4494( var_0, var_1 )
{
    var_2 = gettime();
    thread _id_4492( var_2, var_0, var_1 );
    thread _id_4493( var_2, var_1 );
}

_id_4492( var_0, var_1, var_2 )
{
    level notify( "watching_potg_archive_request" );
    level endon( "watching_potg_archive_request" );

    if ( getdvarint( "#x3f5c43063fe0f37ed" ) == 0 )
        return;

    for (;;)
    {
        var_3 = _func_0395();

        if ( var_3 != var_1 )
        {
            level notify( "potg_archive_request_finished" );
            _id_443C( 1, var_2, var_0, var_3, _func_0396() );
            break;
        }

        waitframe();
    }
}

_id_4493( var_0, var_1 )
{
    level endon( "potg_archive_request_finished" );
    level waittill( "watching_potg_archive_request" );
    _id_443C( 0, var_1, var_0 );
}

_id_443C( var_0, var_1, var_2, var_3, var_4 )
{
    if ( var_0 )
        thread _id_433A( var_2, var_3, var_4, var_1._id_B351, var_1._id_B350 );

    if ( var_0 )
        return;
}
