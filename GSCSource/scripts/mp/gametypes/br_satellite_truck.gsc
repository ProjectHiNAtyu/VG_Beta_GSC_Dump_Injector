// S4 GSC SOURCE
// Generated by https://github.com/xensik/gsc-tool

init()
{
    level._effect["poi_sat_truck_available"] = loadfx( "vfx/iw8_br/gameplay/vfx_br_poi_satnav_white.vfx" );
    level._effect["poi_sat_truck_charging"] = loadfx( "vfx/iw8_br/gameplay/vfx_br_poi_satnav_red.vfx" );
    level._id_2A8B = [];
    level._id_2A8A = getdvarint( "scr_br_satellite_truck", 0 ) != 0;
    level._id_CB20 = getdvarfloat( "scr_br_satellite_truck_active_time", 15 );
    level._id_CB21 = getdvarint( "scr_br_satellite_truck_plunder_cost", 1 );
    scripts\mp\gametypes\br_functional_poi::_id_8282( "satellite_truck" );
    scripts\mp\gametypes\br_functional_poi::_id_C2AD( "satellite_truck", 0, ::_id_0C54, undefined, ::_id_0C58 );
    scripts\mp\gametypes\br_functional_poi::_id_C2AD( "satellite_truck", 1, ::_id_0C52, undefined, ::_id_0C57 );
    scripts\mp\gametypes\br_functional_poi::_id_C2AD( "satellite_truck", 2, ::_id_0C51, undefined, ::_id_0C56 );
    scripts\mp\gametypes\br_functional_poi::_id_C2AD( "satellite_truck", 3, ::_id_0C55, undefined, ::_id_0C59 );
    scripts\mp\gametypes\br_functional_poi::_id_C2AD( "satellite_truck", 4, ::_id_0C53, undefined, undefined );
}

_id_E362( var_0 )
{
    if ( !istrue( level._id_2A8A ) )
        return;

    var_1 = spawn( "script_model", var_0.origin );

    if ( isdefined( var_0.angles ) )
        var_1.angles = var_0.angles;

    var_1 setmodel( "veh8_mil_lnd_mkilo23_skud_static2" );
    var_2 = scripts\engine\utility::_id_6D7A( var_0.target, "targetname" );

    if ( !isdefined( var_1._id_CB1F ) )
    {
        var_3 = spawn( "script_model", var_2.origin );

        if ( isdefined( var_2.angles ) )
            var_3.angles = var_2.angles;

        var_3 setmodel( "electrical_elevator_access_keypad_01" );
        var_3 setcursorhint( "HINT_NOICON" );
        var_3 setuseholdduration( "duration_medium" );
        var_3 sethintdisplayfov( 120 );
        var_3 setusefov( 120 );
        var_3 setuserange( 80 );
        var_3 _meth_83A0( -1 );
        var_1._id_CB1F = var_3;
    }

    var_4 = _id_07D0::_id_C56F( 1 );

    if ( var_4 != -1 )
    {
        _id_07D0::_id_A854( var_4, "active", ( 0, 0, 0 ), "hud_icon_br_satellite_truck" );
        _id_07D0::_id_FB90( var_4, var_1 );
        _id_07D0::_id_FB95( var_4, 1 );
        _id_07D0::_id_A88C( var_4 );
        var_1._id_CB1E = var_4;
        var_1 thread _id_0CAB();
    }
    else
    {

    }

    level._id_2A8B[level._id_2A8B.size] = var_1;
    return var_1;
}

_id_AB6D()
{
    foreach ( var_1 in level._id_2A8B )
        var_1 scripts\mp\gametypes\br_functional_poi::_id_70E6( "satellite_truck", 0 );
}

_id_0CAB()
{
    var_0 = self;
    var_0 endon( "death" );
    var_1 = 1.0;
    var_2 = 5000;
    var_0._id_B7AA = [];

    for (;;)
    {
        wait( var_1 );

        if ( !istrue( level._id_2A82 ) )
            continue;

        foreach ( var_4 in var_0._id_B7AA )
        {
            if ( isdefined( var_4 ) )
                _id_07D0::_id_A88B( var_0._id_CB1E, var_4 );
        }

        var_0._id_B7AA = scripts\mp\utility\player::_id_6C40( var_0.origin, var_2 );

        foreach ( var_4 in var_0._id_B7AA )
        {
            if ( isdefined( var_0._id_B7E1 ) && var_4.team == var_0._id_B7E1 && var_0._id_41D5 == 3 )
                continue;

            _id_07D0::_id_A88A( var_0._id_CB1E, var_4 );
        }
    }
}

_id_0CAC()
{
    var_0 = self;
    var_1 = var_0;
    var_2 = var_0._id_CB1F;

    for (;;)
    {
        var_0 waittill( "poi_state_change" );
        var_3 = var_0._id_41D5;

        if ( !isdefined( var_0._id_1ED9 ) )
            var_0._id_1ED9 = var_3;
        else if ( var_0._id_1ED9 == var_3 )
            continue;

        var_0._id_1ED9 = var_3;

        switch ( var_3 )
        {
            default:
                break;
            case 0:
                break;
            case 1:
                var_1 playsound( "truck_sattruck_initialstartup_os" );
                wait 7.5;
                var_1 playloopsound( "truck_sattruck_idling_lp" );
                break;
            case 2:
                break;
            case 3:
                var_0._id_89FA = 1;
                var_2 playsound( "truck_sattruck_initdeploy_os" );
                wait 4.0;
                var_2 playloopsound( "truck_sattruck_scanning_lp" );
                break;
            case 4:
                var_1 playsound( "truck_sattruck_engineoff" );

                if ( istrue( var_0._id_89FA ) )
                {
                    var_2 playsound( "truck_sattruck_scanning_off" );
                    var_0._id_89FA = undefined;
                    wait 0.05;
                    var_2 stoploopsound();
                }

                wait 0.45;
                var_1 stoploopsound();
                break;
        }
    }
}

_id_0CAA()
{
    var_0 = self;
    var_0 notify( "satelliteTruckUseThinkEnd" );
}

_id_0CAD()
{
    var_0 = self;
    var_0 endon( "death" );
    var_0 _id_0CAA();
    var_0 endon( "satelliteTruckUseThinkEnd" );
    var_0 thread _id_0CAC();
    var_1 = var_0 scripts\mp\gametypes\br_functional_poi::_id_6989();

    for (;;)
    {
        var_0._id_CB1F waittill( "trigger", var_2 );

        if ( var_0 scripts\mp\gametypes\br_functional_poi::_id_6989() != var_1 )
            return;

        if ( var_0 scripts\mp\gametypes\br_functional_poi::_id_6989() == 0 )
        {
            if ( var_2._id_B943 < level._id_CB21 )
            {
                var_2 scripts\mp\hud_message::_id_DC9F( "MP_BR_INGAME/NOT_ENOUGH_PLUNDER_ACTIVATE" );
                continue;
            }
            else
                var_2 scripts\mp\gametypes\br_plunder::_id_B790( var_2._id_B943 - level._id_CB21 );
        }

        if ( var_1 == 0 )
        {
            var_0._id_B7E1 = var_2.team;
            var_0 thread scripts\mp\gametypes\br_functional_poi::_id_70E6( "satellite_truck", 1 );
            return;
        }
        else if ( var_1 == 2 )
        {
            var_0._id_B7E1 = var_2.team;
            var_0 thread scripts\mp\gametypes\br_functional_poi::_id_70E6( "satellite_truck", 3 );
        }
    }
}

_id_0CA9()
{
    var_0 = self;
    var_0 endon( "death" );
    level thread scripts\mp\gametypes\br::_id_EFAA( "br_satellite_truck_active", var_0.player, var_0._id_B7E1 );
    var_1 = 0;
    var_2 = getdvarint( "scr_br_satellite__truck_uav_sweep_speed", 500 );
    var_3 = getdvarint( "scr_br_satellite_truck_uav_sweep_frequency", 2 );

    while ( var_1 * var_3 <= level._id_CB20 )
    {
        _func_02D7( self.origin, var_0._id_B7E1, 5000, var_2 );
        var_1++;
        wait( var_3 );
    }

    var_4 = getdvarfloat( "scr_br_satellite_truck_cooldown_msg", 3 );
    scripts\mp\gametypes\br_functional_poi::_id_DCC4( var_0._id_B7E1, "br_satellite_truck_cooldown", var_4 );
    var_0 thread scripts\mp\gametypes\br_functional_poi::_id_70E6( "satellite_truck", 4 );
}

_id_0C54( var_0 )
{
    var_1 = scripts\mp\gametypes\br_functional_poi::_id_6AA5();
    var_0._id_CB1F _meth_81B0( var_1 );
    var_0._id_CB1F makeuseable();
    var_0._id_CB1F sethintstring( &"MP/BR_ACTIVATE_SATELLITE_TRUCK" );
    var_0 thread _id_0CAD();
    var_2 = scripts\engine\utility::getfx( "poi_sat_truck_available" );
    playfxontag( var_2, var_0, "tag_origin" );
}

_id_0C58( var_0 )
{
    var_0._id_CB1F _meth_81AD();
    var_0 _id_0CAA();
    var_0._id_CB1F makeunusable();
    var_1 = scripts\engine\utility::getfx( "poi_sat_truck_available" );
    stopfxontag( var_1, var_0, "tag_origin" );
}

_id_0C52( var_0 )
{
    var_1 = getdvarfloat( "scr_br_satellite_truck_charge_time", 10 );
    var_0 thread scripts\mp\gametypes\br_functional_poi::_id_70E7( "satellite_truck", 2, var_1 );
    scripts\mp\gametypes\br_functional_poi::_id_DCC4( var_0._id_B7E1, "br_satellite_truck_charging", var_1, int( var_1 * 1000 ) );
    var_2 = scripts\engine\utility::getfx( "poi_sat_truck_charging" );
    playfxontag( var_2, var_0, "tag_origin" );
}

_id_0C57( var_0 )
{
    var_1 = scripts\engine\utility::getfx( "poi_sat_truck_charging" );
    stopfxontag( var_1, var_0, "tag_origin" );
}

_id_0C51( var_0 )
{
    var_1 = scripts\mp\gametypes\br_functional_poi::_id_6AA5();
    var_0._id_CB1F _meth_81B0( var_1 );
    var_0._id_CB1F makeuseable();
    var_0._id_CB1F sethintstring( &"MP/BR_USE_SATELLITE_TRUCK" );
    var_0 thread _id_0CAD();
}

_id_0C56( var_0 )
{
    var_0._id_CB1F _meth_81AD();
    var_0 _id_0CAA();
    var_0._id_CB1F makeunusable();
}

_id_0C55( var_0 )
{
    var_0 thread _id_0CA9();
}

_id_0C59( var_0 )
{
    var_0._id_B7E1 = undefined;
}

_id_0C53( var_0 )
{
    var_1 = getdvarfloat( "scr_br_satellite_truck_cooldown_time", 15 );
    var_0 thread scripts\mp\gametypes\br_functional_poi::_id_70E7( "satellite_truck", 0, var_1 );
}
