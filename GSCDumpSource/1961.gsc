// S4 GSC SOURCE
// Generated by https://github.com/xensik/gsc-tool

init()
{
    level._effect["flashpoint_kill_s1"] = loadfx( "vfx/iw8_mp/flashpoint/vfx_fp_gunfight_s1.vfx" );
    level._effect["flashpoint_kill_s2"] = loadfx( "vfx/iw8_mp/flashpoint/vfx_fp_gunfight_s2.vfx" );
    level._effect["flashpoint_kill_s3"] = loadfx( "vfx/iw8_mp/flashpoint/vfx_fp_gunfight_s3.vfx" );
    level._effect["flashpoint_gunfire_s1"] = loadfx( "vfx/iw8_mp/flashpoint/vfx_fp_gunfight_small_s1.vfx" );
    level._effect["flashpoint_pulse_friendly"] = loadfx( "vfx/iw8_mp/flashpoint/vfx_fp_pulse_friendly.vfx" );
    level._effect["flashpoint_pulse_squad"] = loadfx( "vfx/iw8_mp/flashpoint/vfx_fp_pulse_squad.vfx" );
    level._effect["flashpoint_pulse_enemy"] = loadfx( "vfx/iw8_mp/flashpoint/vfx_fp_pulse_enemy.vfx" );
    var_0 = getdvar( "scr_flashpoint_toggle", 0 );
    level._id_5CA8 = getdvar( "scr_flashpoint_objectives", 0 ) == "1";
    level._id_7C40 = "icon_swords_friendly";
    level._id_7C3F = "icon_swords_enemy";
    level._id_7C3E = "icon_swords_contested";
    level._id_7C41 = "icon_swords_neutral";
    level._id_5CAC = spawnstruct();
    level._id_5CAC._id_5CB6 = [];
    level._id_5CB4 = getdvarint( "scr_flashpointDebugActive", 0 );

    if ( istrue( level._id_5CB2 ) )
        level._id_5CB5 = 16777216;
    else
        level._id_5CB5 = 4194304;

    if ( 0 || var_0 == "1" )
    {
        thread _id_5CAD();
        level._id_5CB3 = 1;
    }
    else
        level._id_5CB3 = 0;

    thread _id_5CAE();
}

_id_5CAE()
{
    for (;;)
    {
        if ( getdvar( "scr_flashpoint_toggle", 0 ) != "0" )
        {
            if ( level._id_5CA8 )
                thread _id_5CAD();

            level._id_5CB3 = 1;

            foreach ( var_1 in level.players )
            {
                if ( !isdefined( var_1._id_5CAF ) )
                    _id_5CB0( var_1 );
            }
        }
        else
        {
            level notify( "disable_flashpoint" );
            level._id_5CB3 = 0;

            if ( level._id_5CA8 )
            {
                foreach ( var_4 in level._id_5CAC._id_5CB6 )
                    _id_5CAA( var_4 );
            }
        }

        wait 1;
    }
}

_id_5CAD()
{
    level endon( "disable_flashpoint" );

    for (;;)
    {
        foreach ( var_1 in level._id_5CAC._id_5CB6 )
        {
            var_2 = gettime();

            if ( var_2 - var_1._id_8FBA > 12500 )
            {
                _id_5CAA( var_1 );
                continue;
            }

            if ( isdefined( var_1._id_A850 ) && var_2 - var_1._id_8FBA >= 7500 && !istrue( var_1._id_5301 ) )
                _id_5CA7( var_1 );

            var_3 = getarraykeys( var_1._id_569C );

            foreach ( var_5 in var_3 )
            {
                if ( var_2 - var_5 > 12500 )
                    var_1._id_569C = scripts\engine\utility::_id_1B9E( var_1._id_569C, var_5 );
            }
        }

        foreach ( var_9 in level.players )
        {
            if ( !isdefined( var_9._id_5CAF ) )
                thread _id_5CB0( var_9 );
        }

        wait 1;
    }
}

_id_5CA9( var_0, var_1, var_2, var_3 )
{
    if ( !level._id_5CB3 )
        return;

    var_4 = ( 0, 0, 0 );

    if ( 0 )
        var_4 = ( randomfloatrange( -1000, 1000 ), randomfloatrange( -1000, 1000 ), 0 );

    if ( var_3 == "gunfire" )
    {
        var_5 = var_0.origin + ( 0, 0, 32 );

        if ( 0 )
            var_5 = var_5 + var_4;

        thread _id_B905( var_5, "flashpoint_kill_s2" );
    }
    else
    {
        var_5 = ( 0, 0, 0 );

        if ( level._id_5CA8 )
            var_5 = _func_0259( var_0.origin + ( 0, 0, 48 ), var_1.origin + ( 0, 0, 48 ), 0.25 );
        else
            var_5 = var_1.origin + ( 0, 0, 48 );

        if ( 0 )
            var_5 = var_5 + var_4;

        if ( level._id_5CA8 )
        {
            var_6 = spawn( "script_model", var_5 );
            var_7 = var_6 scripts\engine\utility::_id_1BAE( level._id_5CAC._id_5CB6, ::_id_E031 );
            var_6 delete();

            foreach ( var_9 in var_7 )
            {
                if ( distancesquared( var_9._id_411F, var_5 ) < level._id_5CB5 )
                {
                    _id_5CB1( var_9, var_5, var_2, var_3 );
                    return;
                }
            }

            if ( level._id_5CAC._id_5CB6.size >= 2 )
                _id_5CA4();

            _id_5CA6( var_5, var_2, var_3 );
        }

        thread _id_B905( var_5, "flashpoint_kill_s2" );
    }
}

_id_5CA6( var_0, var_1, var_2 )
{
    var_3 = spawnstruct();
    var_3._id_411F = var_0;
    var_3._id_8FBA = var_1;
    var_3.team = "";
    _id_5CA2( var_3, var_1, var_2 );
    level._id_5CAC._id_5CB6[level._id_5CAC._id_5CB6.size] = var_3;
}

_id_5CA5( var_0 )
{
    var_0._id_A850 = _id_07AD::_id_4004( var_0._id_411F, "neutral", ( 0, 0, 0 ), undefined, "any" );
    _id_07D0::_id_A89E( var_0._id_A850._id_A8F5, 0 );
    var_0._id_A850._id_96F3 = 0;
    _id_07D0::_id_FB8C( var_0._id_A850._id_A8F5, level._id_7C41 );
    _id_07D0::_id_FB95( var_0._id_A850._id_A8F5, 2 );
    var_0._id_A850._id_96F3 = 1;
}

_id_5CB1( var_0, var_1, var_2, var_3 )
{
    var_0 notify( "end_update" );
    var_0 endon( "end_update" );
    level endon( "disable_flashpoint" );

    if ( !isdefined( var_0._id_A850 ) && var_0._id_569C.size >= 5 )
        _id_5CA5( var_0 );

    var_0._id_5301 = 0;
    var_0._id_8FBA = gettime();

    if ( isdefined( var_0._id_A850 ) && level._id_5CA8 )
        _id_07D0::_id_A8A4( var_0._id_A850._id_A8F5, 0 );
    else
        var_0._id_411F = _func_0259( var_0._id_411F, var_1, 0.75 );

    thread _id_B905( var_1, "flashpoint_kill_s2" );
    _id_5CA2( var_0, var_2, var_3 );
}

_id_5CA2( var_0, var_1, var_2 )
{
    if ( !isdefined( var_0._id_569C ) )
        var_0._id_569C = [];

    var_0._id_569C[var_1] = var_2;

    if ( var_0._id_569C.size > 8 )
    {
        var_3 = [];
        var_4 = 0;

        foreach ( var_7, var_6 in var_0._id_569C )
        {
            if ( var_4 > var_0._id_569C.size - 8 )
                var_3[var_7] = var_6;

            var_4++;
        }

        var_0._id_569C = var_3;
    }
}

_id_5CAA( var_0 )
{
    var_0 notify( "end_update" );

    if ( isdefined( var_0._id_A850 ) && level._id_5CA8 )
    {
        var_0._id_A850 _id_07AD::_id_D8D5( "none" );
        var_0._id_A850 _id_07AD::_id_C2F2();
        var_0._id_A850._id_10418 = "none";
        var_0._id_A850 = undefined;
    }

    level._id_5CAC._id_5CB6 = scripts\engine\utility::array_remove( level._id_5CAC._id_5CB6, var_0 );
}

_id_5CA7( var_0 )
{
    var_0._id_5301 = 1;

    if ( level._id_5CA8 )
        _id_07D0::_id_A8A4( var_0._id_A850._id_A8F5, 1 );
}

_id_5CA3( var_0 )
{
    var_1 = 0;
    var_2 = 0;
    var_3 = "No Change";
    var_4 = var_0.team;

    foreach ( var_6 in var_0._id_569C )
    {
        if ( var_6 == "kill_by_axis" )
        {
            var_1++;
            continue;
        }

        if ( var_6 == "kill_by_allies" )
            var_2++;
    }

    if ( ( var_1 - 1 > var_2 || var_2 == 0 ) && var_0.team != "axis" && var_1 != 0 )
    {
        if ( level._id_5CA8 )
        {
            _id_07D0::_id_FB93( var_0._id_A8F5, "axis" );
            _id_07D0::_id_FB98( var_0._id_A8F5, 0 );
        }

        var_0.team = "axis";
        var_3 = "Switch To Axis Owner";
    }
    else if ( ( var_2 - 1 > var_1 || var_1 == 0 ) && var_0.team != "allies" && var_2 != 0 )
    {
        if ( level._id_5CA8 )
        {
            _id_07D0::_id_FB93( var_0._id_A8F5, "allies" );
            _id_07D0::_id_FB98( var_0._id_A8F5, 0 );
        }

        var_0.team = "allies";
        var_3 = "Switch To Allies Owner";
    }
    else if ( var_0.team != "neutral" && var_2 != 0 && var_1 != 0 )
    {
        if ( level._id_5CA8 )
        {
            _id_07D0::_id_FB93( var_0._id_A8F5, undefined );
            _id_07D0::_id_FB98( var_0._id_A8F5, 1 );
        }

        var_0.team = "neutral";
        var_3 = "Switch To Contested";
    }
}

_id_E031( var_0, var_1 )
{
    return distancesquared( var_0._id_411F, self.origin ) < distancesquared( var_1._id_411F, self.origin );
}

_id_5CA4()
{
    var_0 = undefined;

    foreach ( var_2 in level._id_5CAC._id_5CB6 )
    {
        if ( !isdefined( var_0 ) )
        {
            var_0 = var_2;
            continue;
        }

        if ( var_2._id_8FBA > var_0._id_8FBA )
            var_0 = var_2;
    }

    _id_5CAA( var_0 );
}

_id_B905( var_0, var_1 )
{
    playfx( scripts\engine\utility::getfx( var_1 ), var_0 );
}

_id_5CB0( var_0 )
{
    var_0 endon( "disconnect" );
    level endon( "disable_flashpoint" );
    var_0._id_5CAF = 1;

    for (;;)
    {
        var_0 waittill( "begin_firing" );
        wait 1.0;
        _id_5CA9( var_0, undefined, gettime(), "gunfire" );
        wait 0.25;
    }
}

_id_5CAB()
{
    self endon( "disconnect" );
    self notify( "start_SpawnSelectionThink" );
    self endon( "start_SpawnSelectionThink" );

    while ( self._id_82D8 )
    {
        foreach ( var_1 in level.players )
        {
            if ( !isalive( var_1 ) )
                continue;

            if ( self.team != var_1.team )
            {
                if ( istrue( level._id_E371 ) )
                    _func_0198( level._effect["flashpoint_pulse_enemy"], var_1, "tag_eye", self );

                continue;
            }

            if ( istrue( level._id_E372 ) )
            {
                if ( self._id_E493 == var_1._id_E493 )
                {
                    _func_0198( level._effect["flashpoint_pulse_squad"], var_1, "tag_eye", self );
                    continue;
                }

                _func_0198( level._effect["flashpoint_pulse_friendly"], var_1, "tag_eye", self );
            }
        }

        wait 1.1;
    }
}
