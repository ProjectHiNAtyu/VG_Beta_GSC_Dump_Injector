// S4 GSC SOURCE
// Generated by https://github.com/xensik/gsc-tool

_id_10D77()
{
    level._effect["weapon_drop_impact"] = loadfx( "vfx/iw8_mp/killstreak/vfx_carepkg_landing_dust.vfx" );
}

_id_10D71()
{
    thread _id_10D76();
    return 1;
}

_id_10D76()
{
    level endon( "game_ended" );
    self endon( "death_or_disconnect" );
    waitframe();
    var_0 = scripts\cp_mp\utility\killstreak_utility::_id_4034( "weapondrop", self );
    var_0._id_47CD = makeweapon( "deploy_weapondrop_mp" );
    scripts\common\utility::_id_1527( 0 );
    var_1 = _id_0990::_id_EA00( var_0, var_0._id_47CD, "grenade_fire" );
    scripts\common\utility::_id_1527( 1 );

    if ( istrue( var_1 ) )
    {
        var_0 notify( "killstreak_finished_with_deploy_weapon" );

        if ( scripts\cp_mp\utility\script_utility::issharedfuncdefined( "supers", "superUseFinished" ) )
            [[ scripts\cp_mp\utility\script_utility::getsharedfunc( "supers", "superUseFinished" ) ]]();
    }
    else if ( scripts\cp_mp\utility\script_utility::issharedfuncdefined( "supers", "superUseFinished" ) )
        [[ scripts\cp_mp\utility\script_utility::getsharedfunc( "supers", "superUseFinished" ) ]]( 1 );
}

_id_10D7A( var_0 )
{
    level endon( "game_ended" );
    self endon( "disconnect" );
    var_0 waittill( "explode", var_1 );
    var_0 _id_10D74( self, var_1 );
    return 1;
}

_id_10D74( var_0, var_1 )
{
    var_2 = var_0 _id_098C::_id_4781( var_1, ::_id_10D75 );

    if ( isdefined( var_2 ) )
    {
        var_3 = spawn( "script_model", var_2.origin );
        var_3 setmodel( "military_crate_field_upgrade_01" );
        var_3 setotherent( var_0 );
        var_3.owner = var_0;
        var_3.team = var_0.team;
        var_3 linkto( var_2, "tag_origin", ( 0, 0, -15 ), ( 0, 0, 0 ) );
        var_3 _meth_86FB( "killstreak" );
        var_3 _meth_8703( var_0.team );
        var_2._id_4780 = var_3;
        var_2 thread _id_10D73( var_3 );
    }
}

_id_10D75()
{
    self._id_4780 _id_10D72();
}

_id_10D73( var_0 )
{
    level endon( "game_ended" );
    level endon( "prematch_cleanup" );
    var_0 endon( "deliveryBox_dropped" );
    var_0 endon( "death" );
    self waittill( "death" );
    var_0 thread _id_10D72();
}

_id_10D72()
{
    if ( istrue( self._id_753C ) )
        return;

    self._id_753C = 1;
    self notify( "deliveryBox_dropped" );
    self unlink();
    _id_3E77();
    var_0 = self.origin - ( 0, 0, 1000 );
    scripts\cp_mp\utility\killstreak_utility::_id_8D95( var_0, 100, 1000, 30.0, self.owner, self.team );
    thread _id_10AB8();
    thread _id_10ABA();
}

_id_473F()
{
    _id_3E76();
    self delete();
}

_id_3E77()
{
    if ( istrue( self._id_B03E ) )
        return;

    self._id_B03E = 1;
    self._id_F9A5 = 1;
    self physicslaunchserver( ( 0, 0, 0 ), ( 0, 0, 0 ), 1200 );
    var_0 = self _meth_846D( 0 );
    _func_02D3( var_0, ( 0, 0, -1 ) );
    self physics_registerforcollisioncallback();
}

_id_3E76()
{
    if ( !istrue( self._id_B03E ) )
        return;

    self notify( "crate_physics_off" );
    self._id_B03E = undefined;
    self._id_F9A5 = undefined;
    self _meth_8544();
    self _meth_84FC();
    self stoploopsound( "mp_care_package_drop_lp" );
    scripts\cp_mp\utility\killstreak_utility::_id_8D99();
}

_id_10ABA()
{
    self endon( "crate_physics_off" );
    _id_10ABB();

    if ( scripts\cp_mp\utility\script_utility::issharedfuncdefined( "entity", "touchingBadTrigger" ) )
    {
        if ( self [[ scripts\cp_mp\utility\script_utility::getsharedfunc( "entity", "touchingBadTrigger" ) ]]() )
        {
            thread _id_473F();
            return;
        }
    }

    self.owner thread _id_09D5::_id_16DC( self );
    thread _id_3E76();
}

_id_10ABB()
{
    wait 1;
    var_0 = gettime() + 10000;

    while ( gettime() < var_0 )
    {
        var_1 = self _meth_846D( 0 );
        var_2 = _func_029C( var_1 );

        if ( _func_0133( var_2 ) <= 0.5 )
            break;

        waitframe();
    }
}

_id_10AB8( var_0 )
{
    self endon( "crate_physics_off" );
    self playloopsound( "mp_care_package_drop_lp" );

    if ( isdefined( var_0 ) )
        wait( var_0 );

    var_1 = 0;

    for (;;)
    {
        self waittill( "collision", var_2, var_3, var_4, var_5, var_6, var_7, var_8, var_9 );

        if ( isdefined( var_9 ) && var_9 _id_098C::_id_8883() )
            var_9 thread _id_098C::_id_7850();

        if ( gettime() - var_1 >= 200 )
        {
            var_1 = gettime();
            var_10 = _func_02C5( var_5 );
            var_11 = _func_00D6( var_10["name"], 9 );

            if ( var_11 == "user_terrain1" )
                var_11 = "user_terrain_1";

            _id_B369( var_6, var_7, var_8, var_11 );
        }
    }
}

_id_B369( var_0, var_1, var_2, var_3 )
{
    playfx( scripts\engine\utility::getfx( "weapon_drop_impact" ), var_0, var_1 );

    if ( var_2 < 150 )
        self playsoundtoteam( "mp_care_package_low_impact", var_3 );
    else if ( var_2 < 300 )
        self playsoundtoteam( "mp_care_package_med_impact", var_3 );
    else
        self playsoundtoteam( "mp_care_package_high_impact", var_3 );

    self stoploopsound( "mp_care_package_drop_lp" );
}
